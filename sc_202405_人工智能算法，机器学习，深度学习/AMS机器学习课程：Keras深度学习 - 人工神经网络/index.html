
            <!DOCTYPE html>
            <html lang="en">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <meta name="description" content="使用 Keras 和 Tensorflow 构建 Dense Neural Networks">
                <meta name="keywords" content="AMS机器学习课程：Keras深度学习 - 人工神经网络, 使用 Keras 和 Tensorflow 构建 Dense Neural Networks">
                <meta property="og:title" content="AMS机器学习课程：Keras深度学习 - 人工神经网络">
                <title>AMS机器学习课程：Keras深度学习 - 人工神经网络</title>
                <style>.hidden{visibility:hidden;font-size:1px;}</style>
            </head>
            <body>
                <div class="rich_media_wrp" id="img-content">
<h1 class="rich_media_title" id="activity-name">
            
AMS机器学习课程：Keras深度学习 - 人工神经网络
          </h1>

<div class="rich_media_content js_underline_content" id="js_content" style="visibility: visible;"><blockquote style='box-sizing: border-box;padding-top: 5px;padding-bottom: 5px;padding-left: 15px;margin-top: 0px;margin-bottom: 1.25rem;border-left-width: 5px;border-left-color: rgb(226, 45, 48);color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'><p style="box-sizing: border-box;margin-bottom: 1.25rem;">本文翻译自 AMS 机器学习 Python 教程，并有部分修改。</p><p style="box-sizing: border-box;margin-bottom: 1.25rem;">David John Gagne, 2019: “Deep Learning with Keras”.</p><p style="box-sizing: border-box;">https://github.com/djgagne/ams-ml-python-course/blob/master/module_3/ML_Short_Course_Module_3_Deep_Learning.ipynb</p></blockquote><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>David John Gagne, National Center for Atmospheric Research</p><h2 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.5rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>介绍</h2><h3 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.25rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>目标</h3><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>了解深度学习的定义及其与传统机器学习方法的区别</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>了解 Keras 是什么，它如何工作以及如何与其他深度学习库交互</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>在 Keras 中建立一个全连接神经网络</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>了解激活函数的选择如何影响性能</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>在 Keras 中建立卷积神经网络，并与全连接神经网络比较，看看它的性能如何</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>了解数据是如何通过卷积层转换的</p><h3 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.25rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>软件需求</h3><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>本节使用如下的软件库</p><ul class="list-paddingleft-2" style='margin-bottom: 20px;list-style: square;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);margin-left: 0px;margin-right: 0px;'><li style="box-sizing: border-box;margin-bottom: 5px;"><p>Python 3.6 或更高版本</p></li><li style="box-sizing: border-box;margin-bottom: 5px;"><p>Numpy</p></li><li style="box-sizing: border-box;margin-bottom: 5px;"><p>Pandas</p></li><li style="box-sizing: border-box;margin-bottom: 5px;"><p>Matplotlib</p></li><li style="box-sizing: border-box;margin-bottom: 5px;"><p>IPython</p></li><li style="box-sizing: border-box;margin-bottom: 5px;"><p>Jupyter</p></li><li style="box-sizing: border-box;margin-bottom: 5px;"><p>Xarray</p></li><li style="box-sizing: border-box;margin-bottom: 5px;"><p>netCDF4</p></li><li style="box-sizing: border-box;margin-bottom: 5px;"><p>Tensorflow (为训练卷积神经网络，推荐使用 GPU 版本)</p></li><li style="box-sizing: border-box;margin-bottom: 5px;"><p>Keras</p></li><li style="box-sizing: border-box;margin-bottom: 5px;"><p>CUDA 9.2 或更高版本和 cuDNN (用于与 NVIDIA GPU 接口)</p></li></ul><h3 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.25rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>什么是深度学习</h3><figure style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'><img data-ratio="0.5625" data-src="https://mmbiz.qpic.cn/mmbiz_png/IpKhkdmFuGeJAzkhkIsbicrdpUbvHy3Mz2pX6nFibD1vZvqeCdukjyYY72BjvBIk9elcbmylqEEGXT3g4R1ib6ibPw/640?wx_fmt=png" data-type="png" data-w="720" src="20240525_021840_0.jpeg" style="box-sizing: border-box;vertical-align: bottom;"/></figure><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>深度学习应在人工智能和机器学习的背景下进行定义。</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'><span style="box-sizing: border-box;font-style: inherit;font-variant: inherit;font-stretch: inherit;font-size: inherit;line-height: inherit;font-family: inherit;font-weight: 700;">人工智能 (Artificial Intelligence, AI)</span>：计算机执行传统上由人类完成的认知任务而无需人类直接控制的多种方式。</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>从历史上看，开发人工智能系统有两种思想流派。</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'><span style="box-sizing: border-box;font-style: inherit;font-variant: inherit;font-stretch: inherit;font-size: inherit;line-height: inherit;font-family: inherit;font-weight: 700;">专家系统 (Expert Systems)</span>：任务专家创建描述任务完成方式的算法和规则，然后 AI 程序根据规则完成任务。</p><ul class="list-paddingleft-2" style='margin-bottom: 20px;list-style: square;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);margin-left: 0px;margin-right: 0px;'><li style="box-sizing: border-box;margin-bottom: 5px;"><p>通常实现为模糊逻辑 (Fuzzy Logic)</p></li><li style="box-sizing: border-box;margin-bottom: 5px;"><p>业务示例：NEXRAD Hydrometeor 分类算法，基于对象的诊断评估方法 (Method for Object-based Diagnostic Evaluation, MODE)</p></li><li style="box-sizing: border-box;margin-bottom: 5px;"><p>优点：不需要数据，可解释，可控制</p></li><li style="box-sizing: border-box;margin-bottom: 5px;"><p>缺点：算法脆弱，复杂性难以管理，无法自适应</p></li></ul><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'><span style="box-sizing: border-box;font-style: inherit;font-variant: inherit;font-stretch: inherit;font-size: inherit;line-height: inherit;font-family: inherit;font-weight: 700;">机器学习 (Machine Learning, ML)</span>：具有指定结构的数学模型，从数据中学习执行任务</p><ul class="list-paddingleft-2" style='margin-bottom: 20px;list-style: square;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);margin-left: 0px;margin-right: 0px;'><li style="box-sizing: border-box;margin-bottom: 5px;"><p>常用算法：神经网络 (Neural networks)，决策树 (Decision trees)，支持向量机 (Support vector machines)</p></li><li style="box-sizing: border-box;margin-bottom: 5px;"><p>优点：具有较高的预测能力，可以学习复杂的模式和关系，量化不确定性，可以解释</p></li><li style="box-sizing: border-box;margin-bottom: 5px;"><p>缺点：需要大量数据，特征的大量预处理，外推问题</p></li></ul><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'><span style="box-sizing: border-box;font-style: inherit;font-variant: inherit;font-stretch: inherit;font-size: inherit;line-height: inherit;font-family: inherit;font-weight: 700;">深度学习 (Deep Learning)</span>：机器学习的一个子集，由神经网络和许多专门的隐藏层组成，用于对输入数据中的结构模式进行编码以产生更好的预测</p><ul class="list-paddingleft-2" style='margin-bottom: 20px;list-style: square;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);margin-left: 0px;margin-right: 0px;'><li style="box-sizing: border-box;margin-bottom: 5px;"><p>常用算法：卷积神经网络 (Convolutional neural networks)，递归神经网络 (Recurrent neural networks)</p></li><li style="box-sizing: border-box;margin-bottom: 5px;"><p>优点：与传统机器学习相比，在图像和时序问题上的预测能力更高，所需的预处理和特征提取更少</p></li><li style="box-sizing: border-box;margin-bottom: 5px;"><p>缺点：比传统机器学习需要更多的数据和计算资源，更难于训练，对对抗性数据的敏感性更高</p></li></ul><h3 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.25rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>什么是 Keras</h3><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'><img data-ratio="0.6428571428571429" data-src="https://mmbiz.qpic.cn/mmbiz_png/IpKhkdmFuGeJAzkhkIsbicrdpUbvHy3MzshPpKDdIEujRsJCT9M8Ka2yG8vlDofNQfTtNDOHsibK0UkuA1Mza6PQ/640?wx_fmt=png" data-type="png" data-w="700" src="20240525_021841_1.jpeg" style="box-sizing: border-box;vertical-align: bottom;"/></p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>Keras 是用于深度学习的以人为本的高级API。Keras 提供了一个面向对象的接口，用于通过以不同方式将各层连接在一起来创建任意复杂度的神经网络。因为 Keras 旨在成为一个接口，而不是一个完整的深度学习库，所以它已在多个深度学习库和其他编程语言的基础上实现。Keras 充当 Tensorflow 的官方高级 API，并且还可以与 Theano 和 Microsoft 的 CNTK 交互。Keras 还有一个 R 接口。</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>Keras 使用分层对象表示神经网络。完整的网络存储为 Model 对象，其中包含可顺序或任意连接的层列表。每个层都是其自己的对象，并包含名称和参数，包括权重和配置。为了进行训练和推理，Keras 实现了 scikit-learn 的 fit 和 perdict API，还提供了调用模型及其单个组件的低级方法。keras 后端提供了通过模型的任意子集传递数据的方法，这将使我们能够看到神经网络如何转换数据以进行预测。</p><h2 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.5rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>数据</h2><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>本文数据的下载方法请查阅</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'><a data-itemshowtype="0" data-linktype="2" href="#" tab="innerlink" target="_blank">AMS机器学习课程：数据分析与预处理 - 准备数据</a><br/></p><h3 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.25rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>准备</h3><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>载入需要使用的库</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'><span style="box-sizing: border-box;color: rgb(249, 38, 114);">import</span> numpy <span style="box-sizing: border-box;color: rgb(249, 38, 114);">as</span> np<br/><span style="box-sizing: border-box;color: rgb(249, 38, 114);">import</span> pandas <span style="box-sizing: border-box;color: rgb(249, 38, 114);">as</span> pd<br/><span style="box-sizing: border-box;color: rgb(249, 38, 114);">import</span> xarray <span style="box-sizing: border-box;color: rgb(249, 38, 114);">as</span> xr<br/><span style="box-sizing: border-box;color: rgb(249, 38, 114);">import</span> matplotlib.pyplot <span style="box-sizing: border-box;color: rgb(249, 38, 114);">as</span> plt<br/><br/><span style="box-sizing: border-box;color: rgb(249, 38, 114);">import</span> pathlib<br/><span style="box-sizing: border-box;color: rgb(249, 38, 114);">from</span> tqdm.notebook <span style="box-sizing: border-box;color: rgb(249, 38, 114);">import</span> tqdm</code></pre><h3 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.25rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>载入</h3><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>首先，我们将加载训练网络所需的 csv 数据文件并将它们连接在一起。</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>csv_path <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> pathlib<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>Path(<span style="box-sizing: border-box;color: rgb(230, 219, 116);">"../data/track_data_ncar_ams_3km_csv_small"</span>)<br/>csv_files <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> sorted(csv_path<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>glob(<span style="box-sizing: border-box;color: rgb(230, 219, 116);">"*.csv"</span>))<br/>len(csv_files)</code></pre><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: 16px;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(0, 0, 0);text-align: start;'><code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>100<br/></code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>使用 <code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding-right: 5px;padding-left: 5px;color: rgb(204, 51, 51);'>pd.read_csv()</code> 加载 CSV 文件</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>csv_data_list <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> []<br/><span style="box-sizing: border-box;color: rgb(102, 217, 239);">for</span> csv_file <span style="box-sizing: border-box;color: rgb(249, 38, 114);">in</span> csv_files:<br/>    csv_data_list<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>append(pd<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>read_csv(csv_file))</code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>使用 <code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding-right: 5px;padding-left: 5px;color: rgb(204, 51, 51);'>pd.concat</code> 将多个 DataFrame 对象合并为一个对象。同时删掉列表对象以节省空间</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>csv_data <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> pd<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>concat(csv_data_list, ignore_index<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span>True)<br/><span style="box-sizing: border-box;color: rgb(102, 217, 239);">del</span> csv_data_list</code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>CSV 数据文件中的列名</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'><span style="box-sizing: border-box;color: rgb(102, 217, 239);">for</span> column <span style="box-sizing: border-box;color: rgb(249, 38, 114);">in</span> csv_data<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>columns:<br/>    <span style="box-sizing: border-box;color: rgb(102, 217, 239);">print</span>(column)</code></pre><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: 16px;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(0, 0, 0);text-align: start;'><code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>Step_ID<br/>Track_ID<br/>Ensemble_Name<br/>Ensemble_Member<br/>Run_Date<br/>Valid_Date<br/>Forecast_Hour<br/>Valid_Hour_UTC<br/>Duration<br/>Centroid_Lon<br/>Centroid_Lat<br/>Centroid_X<br/>Centroid_Y<br/>Storm_Motion_U<br/>Storm_Motion_V<br/>REFL_COM_mean<br/>REFL_COM_max<br/>REFL_COM_min<br/>REFL_COM_std<br/>REFL_COM_percentile_10<br/>REFL_COM_percentile_25<br/>REFL_COM_percentile_50<br/>REFL_COM_percentile_75<br/>REFL_COM_percentile_90<br/>U10_mean<br/>U10_max<br/>U10_min<br/>U10_std<br/>U10_percentile_10<br/>U10_percentile_25<br/>U10_percentile_50<br/>U10_percentile_75<br/>U10_percentile_90<br/>V10_mean<br/>V10_max<br/>V10_min<br/>V10_std<br/>V10_percentile_10<br/>V10_percentile_25<br/>V10_percentile_50<br/>V10_percentile_75<br/>V10_percentile_90<br/>T2_mean<br/>T2_max<br/>T2_min<br/>T2_std<br/>T2_percentile_10<br/>T2_percentile_25<br/>T2_percentile_50<br/>T2_percentile_75<br/>T2_percentile_90<br/>RVORT1_MAX-future_mean<br/>RVORT1_MAX-future_max<br/>RVORT1_MAX-future_min<br/>RVORT1_MAX-future_std<br/>RVORT1_MAX-future_percentile_10<br/>RVORT1_MAX-future_percentile_25<br/>RVORT1_MAX-future_percentile_50<br/>RVORT1_MAX-future_percentile_75<br/>RVORT1_MAX-future_percentile_90<br/>HAIL_MAXK1-future_mean<br/>HAIL_MAXK1-future_max<br/>HAIL_MAXK1-future_min<br/>HAIL_MAXK1-future_std<br/>HAIL_MAXK1-future_percentile_10<br/>HAIL_MAXK1-future_percentile_25<br/>HAIL_MAXK1-future_percentile_50<br/>HAIL_MAXK1-future_percentile_75<br/>HAIL_MAXK1-future_percentile_90<br/>area<br/>eccentricity<br/>major_axis_length<br/>minor_axis_length<br/>orientation<br/>Matched<br/>Max_Hail_Size<br/>Num_Matches<br/>Shape<br/>Location<br/>Scale<br/></code></pre><h2 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.5rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>问题</h2><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>我们将选择一组输入变量和一个输出字段，根据日期拆分数据，并提取强旋转 (strong rotation) 情况。</p><h3 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.25rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>定义问题</h3><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>输入和输出变量</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>input_columns <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> [<br/>    <span style="box-sizing: border-box;color: rgb(230, 219, 116);">"REFL_COM_mean"</span>,<br/>    <span style="box-sizing: border-box;color: rgb(230, 219, 116);">"U10_mean"</span>,<br/>    <span style="box-sizing: border-box;color: rgb(230, 219, 116);">"V10_mean"</span>,<br/>    <span style="box-sizing: border-box;color: rgb(230, 219, 116);">"T2_mean"</span><br/>]<br/><br/>output_column <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> <span style="box-sizing: border-box;color: rgb(230, 219, 116);">"RVORT1_MAX-future_max"</span></code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>涡度阈值，s-1。</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>使用阈值将连续数据变为离散数据，从而形成分类问题</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>out_threshold <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0.005</span></code></pre><h3 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.25rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>构建训练集和测试集</h3><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>将数据集按时间分为训练集和测试集</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>train_test_date <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> pd<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>Timestamp(<span style="box-sizing: border-box;color: rgb(230, 219, 116);">"2015-01-01"</span>)</code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>使用 <code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding-right: 5px;padding-left: 5px;color: rgb(204, 51, 51);'>Valid_Date</code> 字段筛选</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>valid_dates <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> pd<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>DatetimeIndex(csv_data[<span style="box-sizing: border-box;color: rgb(230, 219, 116);">"Valid_Date"</span>])<br/>valid_dates</code></pre><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: 16px;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(0, 0, 0);text-align: start;'><code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>DatetimeIndex(['2010-10-24 12:00:00', '2010-10-24 12:00:00',<br/>               '2010-10-24 12:00:00', '2010-10-24 13:00:00',<br/>               '2010-10-24 14:00:00', '2010-10-24 15:00:00',<br/>               '2010-10-24 12:00:00', '2010-10-24 13:00:00',<br/>               '2010-10-24 14:00:00', '2010-10-24 15:00:00',<br/>               ...<br/>               '2017-03-30 11:00:00', '2017-03-30 11:00:00',<br/>               '2017-03-30 11:00:00', '2017-03-30 11:00:00',<br/>               '2017-03-30 11:00:00', '2017-03-30 11:00:00',<br/>               '2017-03-30 11:00:00', '2017-03-30 11:00:00',<br/>               '2017-03-30 11:00:00', '2017-03-30 11:00:00'],<br/>              dtype='datetime64[ns]', name='Valid_Date', length=121137, freq=None)<br/></code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>为神经网络提取训练输入数据</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>train_data <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> csv_data<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>loc[valid_dates <span style="box-sizing: border-box;color: rgb(249, 38, 114);">&lt;</span> train_test_date, input_columns]<br/>train_data</code></pre><figure style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'><img data-ratio="1.0185387131952017" data-src="https://mmbiz.qpic.cn/mmbiz_png/IpKhkdmFuGeJAzkhkIsbicrdpUbvHy3MzhZBp9WJOiciaOnWXDGSGfY8MtMu63Io12H2gMuvUXSI2jnNzg1icbzpSg/640?wx_fmt=png" data-type="png" data-w="917" src="20240525_021842_2.jpeg" style="box-sizing: border-box;vertical-align: bottom;"/></figure><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>提取训练目标数据，将强旋转标记为 1，弱旋转或无旋转标记为 0</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>train_out <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>where(<br/>    csv_data<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>loc[valid_dates <span style="box-sizing: border-box;color: rgb(249, 38, 114);">&lt;</span> train_test_date, output_column] <span style="box-sizing: border-box;color: rgb(249, 38, 114);">&gt;</span> out_threshold,<br/>    <span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>,<br/>    <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>,<br/>)<br/>train_out</code></pre><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: 16px;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(0, 0, 0);text-align: start;'><code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>array([0, 0, 0, ..., 0, 0, 0])<br/></code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>训练数据中强旋转的比例</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>train_out<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>sum() <span style="box-sizing: border-box;color: rgb(249, 38, 114);">/</span> train_out<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>size <span style="box-sizing: border-box;color: rgb(249, 38, 114);">*</span> <span style="box-sizing: border-box;color: rgb(174, 129, 255);">100</span></code></pre><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: 16px;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(0, 0, 0);text-align: start;'><code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>4.552417612632075<br/></code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>提取测试数据</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>test_data <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> csv_data<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>loc[valid_dates <span style="box-sizing: border-box;color: rgb(249, 38, 114);">&gt;=</span> train_test_date, input_columns]<br/>test_data</code></pre><figure style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'><img data-ratio="0.9604166666666667" data-src="https://mmbiz.qpic.cn/mmbiz_png/IpKhkdmFuGeJAzkhkIsbicrdpUbvHy3MzicST33EtvLyGIibm8HjjsaiaqUabWHhWkthZ8HibGnKLxafibc8lvjicvM3Q/640?wx_fmt=png" data-type="png" data-w="960" src="20240525_021843_3.jpeg" style="box-sizing: border-box;vertical-align: bottom;"/></figure><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>test_out <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>where(<br/>    csv_data<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>loc[valid_dates <span style="box-sizing: border-box;color: rgb(249, 38, 114);">&gt;=</span> train_test_date, output_column] <span style="box-sizing: border-box;color: rgb(249, 38, 114);">&gt;</span> out_threshold,<br/>    <span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>,<br/>    <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>,<br/>)</code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>测试数据中强旋转的比例</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>test_out<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>sum() <span style="box-sizing: border-box;color: rgb(249, 38, 114);">/</span> test_out<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>size <span style="box-sizing: border-box;color: rgb(249, 38, 114);">*</span> <span style="box-sizing: border-box;color: rgb(174, 129, 255);">100</span></code></pre><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: 16px;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(0, 0, 0);text-align: start;'><code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>5.26586237712243<br/></code></pre><h3 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.25rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>处理输入数据</h3><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>我们将使用标准缩放器对神经网络的输入数据进行归一化。</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>用训练集适配归一化器 <code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding-right: 5px;padding-left: 5px;color: rgb(204, 51, 51);'>StandardScaler</code></p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'><span style="box-sizing: border-box;color: rgb(249, 38, 114);">from</span> sklearn.preprocessing <span style="box-sizing: border-box;color: rgb(249, 38, 114);">import</span> StandardScaler<br/><br/>scaler <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> StandardScaler()<br/>train_norm <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> scaler<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>fit_transform(train_data)</code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>每个输入变量的归一化参数</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'><span style="box-sizing: border-box;color: rgb(102, 217, 239);">for</span> i, input_col <span style="box-sizing: border-box;color: rgb(249, 38, 114);">in</span> enumerate(input_columns):<br/>    <span style="box-sizing: border-box;color: rgb(102, 217, 239);">print</span>(<br/>        f<span style="box-sizing: border-box;color: rgb(230, 219, 116);">"{input_columns[i]:13s} "</span><br/>        f<span style="box-sizing: border-box;color: rgb(230, 219, 116);">"Mean: {scaler.mean_[i]:.3f} "</span><br/>        f<span style="box-sizing: border-box;color: rgb(230, 219, 116);">"SD: {scaler.scale_[i]:.3f}"</span><br/>    )</code></pre><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: 16px;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(0, 0, 0);text-align: start;'><code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>REFL_COM_mean Mean: 46.847 SD: 3.984<br/>U10_mean      Mean: 0.450 SD: 4.348<br/>V10_mean      Mean: 0.543 SD: 4.462<br/>T2_mean       Mean: 289.409 SD: 6.932<br/></code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>使用训练集的归一化参数处理测试数据</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>test_norm <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> scaler<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>transform(test_data)</code></pre><h2 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.5rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>方法</h2><h3 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.25rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>Dense Neural Networks 稠密神经网络</h3><figure style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'><img data-ratio="0.49051833122629585" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/IpKhkdmFuGeJAzkhkIsbicrdpUbvHy3MzylibHgfhQERSiaAicSONDq8DwvZTRpcnnlKDiaXeicURicyEkz59ps6BKXKg/640?wx_fmt=jpeg" data-type="jpeg" data-w="791" src="20240525_021844_4.jpeg" style="box-sizing: border-box;vertical-align: bottom;"/></figure><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>人工神经网络 (Artificial neural network) 是一种机器学习算法，可以将一组输入非线性转换为一个或多个输出。人工神经网络受到大脑中神经元的工作方式的模糊启发，但并未明确地对大脑建模。神经网络由一个输入层，一个或多个隐藏层以及一个输出层组成。隐藏层对上一层的输出执行转换，输出层将隐藏表示转换为预测。每层由一组感知器 (perceptrons) 或人工神经元 (artificial neurons) 组成。</p><figure style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'><img data-ratio="0.5705614567526556" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/IpKhkdmFuGeJAzkhkIsbicrdpUbvHy3Mz11NZOKGibCFH3W6T44JknedFGusfDp2yyuphKNaiaClISE2OMhZps64w/640?wx_fmt=jpeg" data-type="jpeg" data-w="659" src="20240525_021845_5.jpeg" style="box-sizing: border-box;vertical-align: bottom;"/></figure><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>在每个神经元内部是一组与神经元的每个输入关联的权重和一个附加偏差项。本质上，这部分是线性回归。输入乘以权重，然后相加。</p><h3 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.25rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>激活函数</h3><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>然后，该总和通过激活函数 (activation function) 传递，该函数以某种非线性方式转换数据。激活函数的目标通常是通过将某些神经元设置为 0 来增加表示的稀疏性或限制可能值的范围。通常在网络的密集层或卷积层之后直接使用激活。下面绘制了一组常见的激活函数及其梯度或导数。</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>占位符输入张量允许将 numpy 数组通过函数馈入 Tensorflow</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>译者注：因为安装的 tensorflow 版本是 2.x，这里使用兼容 v1 版本的接口</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'><span style="box-sizing: border-box;color: rgb(249, 38, 114);">import</span> tensorflow <span style="box-sizing: border-box;color: rgb(249, 38, 114);">as</span> tf<br/><span style="box-sizing: border-box;color: rgb(249, 38, 114);">import</span> tensorflow.compat.v1.keras <span style="box-sizing: border-box;color: rgb(249, 38, 114);">as</span> keras<br/><span style="box-sizing: border-box;color: rgb(249, 38, 114);">import</span> tensorflow.compat.v1.keras.backend <span style="box-sizing: border-box;color: rgb(249, 38, 114);">as</span> K<br/><br/>config <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> tf<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>compat<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>v1<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>ConfigProto()<br/>config<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>gpu_options<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>allow_growth <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> True<br/>session <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> tf<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>compat<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>v1<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>Session(config<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span>config)<br/>K<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>set_session(session)<br/><br/>tf<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>compat<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>v1<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>disable_eager_execution()<br/><br/>act_in <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> K<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>placeholder()</code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>激活函数列表</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>activations <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> [<br/>    <span style="box-sizing: border-box;color: rgb(230, 219, 116);">"sigmoid"</span>,<br/>    <span style="box-sizing: border-box;color: rgb(230, 219, 116);">"tanh"</span>,<br/>    <span style="box-sizing: border-box;color: rgb(230, 219, 116);">"relu"</span>,<br/>    <span style="box-sizing: border-box;color: rgb(230, 219, 116);">"elu"</span>,<br/>]</code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>准备数据对象</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'><span style="box-sizing: border-box;color: rgb(249, 38, 114);">from</span> tensorflow.compat.v1.keras.layers <span style="box-sizing: border-box;color: rgb(249, 38, 114);">import</span> Activation, LeakyReLU<br/><br/>input_vals <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>linspace(<span style="box-sizing: border-box;color: rgb(249, 38, 114);">-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">100</span>)<br/>output_vals <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> []<br/><br/>activation_functions <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> []</code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>绘图</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'><code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding-right: 5px;padding-left: 5px;color: rgb(204, 51, 51);'>K.function</code> 在 2 个相连的 keras 张量之间创建通用输入输出函数</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'><code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding-right: 5px;padding-left: 5px;color: rgb(204, 51, 51);'>K.gradients</code> 计算任意输入和输出配对之间的梯度</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>figure(figsize<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span>(<span style="box-sizing: border-box;color: rgb(174, 129, 255);">12</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">6</span>))<br/><br/><span style="box-sizing: border-box;color: rgb(117, 113, 94);"># 函数值</span><br/>plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>subplot(<span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>)<br/>plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>plot(<br/>    input_vals,<br/>    np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>zeros(input_vals<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>shape),<br/>    <span style="box-sizing: border-box;color: rgb(230, 219, 116);">"k--"</span><br/>)<br/><br/><span style="box-sizing: border-box;color: rgb(102, 217, 239);">for</span> activation <span style="box-sizing: border-box;color: rgb(249, 38, 114);">in</span> activations:<br/>    activation_functions<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>append(<br/>        K<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>function(<br/>            [act_in],<br/>            [Activation(activation)(act_in)]<br/>        )<br/>    )<br/>    <br/>    output_vals<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>append(activation_functions[<span style="box-sizing: border-box;color: rgb(249, 38, 114);">-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>]([input_vals])[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>])<br/>    <br/>    plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>plot(<br/>        input_vals,<br/>        output_vals[<span style="box-sizing: border-box;color: rgb(249, 38, 114);">-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>],<br/>        label<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span>activation,<br/>    )<br/>    <br/>activation_functions<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>append(<br/>    K<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>function(<br/>        [act_in],<br/>        [LeakyReLU(<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0.2</span>)(act_in)]<br/>    )<br/>)<br/>output_vals<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>append(<br/>    activation_functions[<span style="box-sizing: border-box;color: rgb(249, 38, 114);">-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>]([input_vals])[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>]<br/>)<br/>plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>plot(<br/>    input_vals,<br/>    output_vals[<span style="box-sizing: border-box;color: rgb(249, 38, 114);">-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>],<br/>    label<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">"leaky relu"</span>,<br/>)<br/><br/>plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>xlabel(<span style="box-sizing: border-box;color: rgb(230, 219, 116);">"Input"</span>, fontsize<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">14</span>)<br/>plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>ylabel(<span style="box-sizing: border-box;color: rgb(230, 219, 116);">"Activation"</span>, fontsize<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">14</span>)<br/>plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>title(<span style="box-sizing: border-box;color: rgb(230, 219, 116);">"ANN Ativation Functions"</span>, fontsize<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">16</span>)<br/>plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>legend(fontsize<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">12</span>)<br/><br/><span style="box-sizing: border-box;color: rgb(117, 113, 94);"># 梯度</span><br/>plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>subplot(<span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>)<br/>plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>plot(<br/>    input_vals,<br/>    np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>zeros(input_vals<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>shape),<br/>    <span style="box-sizing: border-box;color: rgb(230, 219, 116);">"k--"</span>,<br/>)<br/><span style="box-sizing: border-box;color: rgb(102, 217, 239);">for</span> activation <span style="box-sizing: border-box;color: rgb(249, 38, 114);">in</span> activations:<br/>    activation_functions<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>append(<br/>        K<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>function(<br/>            [act_in],<br/>            K<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>gradients(Activation(activation)(act_in), act_in)<br/>        )<br/>    )<br/>    output_vals<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>append(activation_functions[<span style="box-sizing: border-box;color: rgb(249, 38, 114);">-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>]([input_vals])[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>])<br/>    plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>plot(<br/>        input_vals,<br/>        output_vals[<span style="box-sizing: border-box;color: rgb(249, 38, 114);">-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>],<br/>        label<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span>activation<br/>    )<br/>    <br/>activation_functions<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>append(<br/>    K<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>function(<br/>        [act_in],<br/>        K<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>gradients(LeakyReLU(<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0.2</span>)(act_in), act_in)<br/>    )<br/>)<br/>output_vals<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>append(<br/>    activation_functions[<span style="box-sizing: border-box;color: rgb(249, 38, 114);">-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>]([input_vals])[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>]<br/>)<br/>plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>plot(<br/>    input_vals,<br/>    output_vals[<span style="box-sizing: border-box;color: rgb(249, 38, 114);">-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>],<br/>    label<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">"leaky relu"</span>,<br/>)<br/><br/>plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>xlabel(<span style="box-sizing: border-box;color: rgb(230, 219, 116);">"Input"</span>, fontsize<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">14</span>)<br/>plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>ylabel(<span style="box-sizing: border-box;color: rgb(230, 219, 116);">"Activation Gradients"</span>, fontsize<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">14</span>)<br/>plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>title(<span style="box-sizing: border-box;color: rgb(230, 219, 116);">"Ann Activation Gradients"</span>, fontsize<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">16</span>)<br/>plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>show()</code></pre><figure style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'><img data-ratio="0.5361527967257844" data-src="https://mmbiz.qpic.cn/mmbiz_png/IpKhkdmFuGeJAzkhkIsbicrdpUbvHy3MzyXdY1AYIYonjdu2eUjge6ckIyCvEPJwXatkGyf0I3oTVw6fEcD6eVQ/640?wx_fmt=png" data-type="png" data-w="1466" src="20240525_021847_6.jpeg" style="box-sizing: border-box;vertical-align: bottom;"/></figure><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>常见的激活函数如上图所示。传统的人工神经网络使用 sigmoid 或双曲线正切（tanh）激活函数来模拟大脑中神经元的激活。sigmoids 和 tanh 的问题在于，当错误信息通过网络反向传播时，sigmoids 的最大斜率（相对于输出变化的输入导数）约为 0.3，因此每次向后通过 sigmoids 将梯度幅度降低 70％ 或更多。这导致了深度神经网络的“消失梯度问题 (vanishing gradient problem)”。在 2 或 3 层之后，梯度的大小太小，无法提供有关权重如何更新的一致信号，从而导致模型的收敛性较差。</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>Rectified Linear Unit (ReLU) 激活通过执行变换来解决此问题，即正值保留其原始大小而负值设置为0。由于正梯度的大小不会减小，因此梯度信号可以传播很多层而不消失。将负梯度清零有时可能会导致神经元死亡，因此已创建 ReLU 的变体（例如 Leaky ReLU 和 Exponential Linear Unit (ELU)）来传播负信息，但幅度减小。</p><h3 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.25rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>神经网络训练</h3><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>通过随机梯度下降 (stochastic gradient descent) 过程优化神经网络的权重。</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>一批或随机的训练数据子集通过神经网络发送以生成预测。</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>通过使用损失或误差函数，将这些预测与真实的标签或值进行比较。回归的常见误差函数是均方误差 (Mean squared error)。由于均方误差等于 Brier 评分 (Brier Score)，因此它也可以用于二元分类问题。分类的另一个常见损失函数是交叉熵 (cross-entropy)，即</p><p style="text-align: center;"><img class="rich_pages" data-ratio="0.2572992700729927" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/IpKhkdmFuGeJAzkhkIsbicrdpUbvHy3MzTsIOvyUE80XTKUPJNZ6xvibpXvicvzH8XZtGHsq2Nf7ticjcNeB6t8GPQ/640?wx_fmt=png" data-type="png" data-w="548" src="20240525_021848_7.jpeg" style=""/></p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>其中 y 为 1 或 0，而 p 为预测概率。</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>计算出相对于网络中每个权重的误差的导数（dL/dw）。网络中给定权重的导数取决于给定神经元和输出层之间任何神经元的权重的导数，因此必须首先计算这些导数。此过程称为反向传播 (back-propagation)。</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>一旦为给定的权重计算了导数，就通过从原始权重中减去导数的一部分来更新权重。</p><p style="text-align: center;"><img class="rich_pages" data-ratio="0.6461538461538462" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/IpKhkdmFuGeJAzkhkIsbicrdpUbvHy3MzpqBzVxQdvj9kTZEVP1g7E37UPERuTSNTS3oDu3iceIrlkMicJHu0oiaQA/640?wx_fmt=png" data-type="png" data-w="260" src="20240525_021849_8.jpeg" style=""/></p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>分数 theta 被称为学习率。通过逆梯度进行优化的过程称为梯度下降 (gradient descent)。当对训练数据的随机子集而不是所有训练数据执行时，该过程称为随机梯度下降 (stochastic gradient descent)。</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>较大的学习速率会导致更快的收敛速度，但是太大的学习速率会导致优化器超出全局最小值。如果学习率太小，则优化器可能会陷入局部最小值或永远不会收敛。已经开发出专门的优化器功能来解决其中一些问题。</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>SGD：Stochastic Gradient Descent，随机梯度下降。随机成分来自为每个更新选择随机的训练示例“批次”。SGD 包括一个向梯度下降更新添加动量的选项，该选项使优化器可以保留以前的梯度在随机梯度计算中减少方差的记忆。实际上，通常建议在 0.99 附近使用较高的动量值。</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>Adam：“adaptive moment”的缩写。该优化器根据 first and second moments of the gradient 自动更新学习率。关键参数是 <code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding-right: 5px;padding-left: 5px;color: rgb(204, 51, 51);'>beta_1</code> 和 <code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding-right: 5px;padding-left: 5px;color: rgb(204, 51, 51);'>beta_2</code>，分别默认为 0.9 和 0.99。作者已经成功地将学习率和 beta_1 设置为较低的值，但是默认值效果很好。</p><h2 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.5rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>实现</h2><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>Keras 稠密神经网络</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>现在我们训练一个简单的单层神经网络，预测强旋转的概率</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>注：这里的单层指的是只有一个隐藏层</p><h3 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.25rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>配置</h3><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>设置块大小</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>batch_size <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> <span style="box-sizing: border-box;color: rgb(174, 129, 255);">128</span></code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>一个 epoch 是对训练数据的一次遍历</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>num_epochs <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> <span style="box-sizing: border-box;color: rgb(174, 129, 255);">10</span></code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>隐藏层中的神经元数目</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>hidden_neurons <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> <span style="box-sizing: border-box;color: rgb(174, 129, 255);">10</span></code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>学习率</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>learning_rate <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0.01</span></code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>使用 SGD 优化器，或将其修改为 Adam 对象</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'><span style="box-sizing: border-box;color: rgb(249, 38, 114);">from</span> tensorflow.compat.v1.keras.optimizers <span style="box-sizing: border-box;color: rgb(249, 38, 114);">import</span> SGD, Adam<br/><br/>optimizer <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> SGD(<br/>    lr<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span>learning_rate,<br/>    momentum<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">0.9</span>,<br/>)</code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>损失函数可以是 <code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding-right: 5px;padding-left: 5px;color: rgb(204, 51, 51);'>binary_crossentropy</code> 或者 mse</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>loss <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> <span style="box-sizing: border-box;color: rgb(230, 219, 116);">"binary_crossentropy"</span></code></pre><h3 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.25rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>构建网络</h3><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>创建输入层</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'><span style="box-sizing: border-box;color: rgb(249, 38, 114);">from</span> tensorflow.compat.v1.keras.layers <span style="box-sizing: border-box;color: rgb(249, 38, 114);">import</span> Input<br/><br/>small_net_input <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> Input(<br/>    shape<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span>(len(input_columns),)<br/>)<br/>small_net_input</code></pre><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: 16px;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(0, 0, 0);text-align: start;'><code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>&lt;tf.Tensor 'input_1:0' shape=(None, 4) dtype=float32&gt;<br/></code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>隐藏层，使用 tanh 激活函数</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'><span style="box-sizing: border-box;color: rgb(249, 38, 114);">from</span> tensorflow.compat.v1.keras.layers <span style="box-sizing: border-box;color: rgb(249, 38, 114);">import</span> Dense<br/><br/>small_net_hidden <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> Dense(<br/>    hidden_neurons,<br/>    activation<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">"tanh"</span><br/>)(small_net_input)<br/>small_net_hidden</code></pre><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: 16px;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(0, 0, 0);text-align: start;'><code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>&lt;tf.Tensor 'dense/Tanh:0' shape=(None, 10) dtype=float32&gt;<br/></code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>输出层，使用 sigmoid 激活函数</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>small_net_out <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> Dense(<br/>    <span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>,<br/>    activation<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">"sigmoid"</span><br/>)(small_net_hidden)<br/>small_net_out</code></pre><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: 16px;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(0, 0, 0);text-align: start;'><code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>&lt;tf.Tensor 'dense_1/Sigmoid:0' shape=(None, 1) dtype=float32&gt;<br/></code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>将上面层合并为一个模型对象</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'><span style="box-sizing: border-box;color: rgb(249, 38, 114);">from</span> tensorflow.compat.v1.keras.models <span style="box-sizing: border-box;color: rgb(249, 38, 114);">import</span> Model<br/><br/>small_model <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> Model(<br/>    small_net_input,<br/>    small_net_out,<br/>)<br/>small_model</code></pre><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: 16px;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(0, 0, 0);text-align: start;'><code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>&lt;tensorflow.python.keras.engine.functional.Functional at 0x1b33dce63c8&gt;<br/></code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>编译模型对象，实例化所有的 tensorflow 连接</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>small_model<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>compile(<br/>    optimizer,<br/>    loss<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span>loss,<br/>)</code></pre><h3 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.25rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>训练</h3><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;'><span style="background-color: rgb(255, 255, 255);">块大小 <code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding-right: 5px;padding-left: 5px;color: rgb(204, 51, 51);'>batch_size</code> 应该能整除训练样本数。将剩余样本去除</span>以<span style="background-color: rgb(255, 255, 255);">确保这点。</span></p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>batch_diff <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> train_norm<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>shape[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>] <span style="box-sizing: border-box;color: rgb(249, 38, 114);">%</span> batch_size</code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>创建训练集索引，为后续随机块采样做准备</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>batch_indices <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>arange(train_norm<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>shape[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>] <span style="box-sizing: border-box;color: rgb(249, 38, 114);">-</span> batch_diff)<br/>num_batches <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> int(batch_indices<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>size <span style="box-sizing: border-box;color: rgb(249, 38, 114);">/</span> batch_size)</code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>从网络中提取权重</p><ul class="list-paddingleft-2" style='margin-bottom: 20px;list-style: square;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);margin-left: 0px;margin-right: 0px;'><li style="box-sizing: border-box;margin-bottom: 5px;"><p><code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding-right: 5px;padding-left: 5px;color: rgb(204, 51, 51);'>hw</code>：hidden weights，隐藏层权重，(4, 10)，即将 4 个输入变量映射到 10 个单元中</p></li><li style="box-sizing: border-box;margin-bottom: 5px;"><p><code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding-right: 5px;padding-left: 5px;color: rgb(204, 51, 51);'>hb</code>：hidden bias</p></li><li style="box-sizing: border-box;margin-bottom: 5px;"><p><code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding-right: 5px;padding-left: 5px;color: rgb(204, 51, 51);'>ow</code>：output weights，输出层权重，(10, 1)，即将 10 个变量映射到 1 个单元中</p></li><li style="box-sizing: border-box;margin-bottom: 5px;"><p><code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding-right: 5px;padding-left: 5px;color: rgb(204, 51, 51);'>ob</code>：output bias</p></li></ul><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>hw, hb, ow, ob <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> small_model<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>get_weights()<br/>hw<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>shape, ow<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>shape</code></pre><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: 16px;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(0, 0, 0);text-align: start;'><code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>((4, 10), (10, 1))<br/></code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>为每块保存隐藏和输出层的权重</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>hw_series <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>zeros(<br/>    [num_batches <span style="box-sizing: border-box;color: rgb(249, 38, 114);">*</span> num_epochs] <span style="box-sizing: border-box;color: rgb(249, 38, 114);">+</span> list(hw<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>shape)<br/>)<br/>ow_series <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>zeros(<br/>    [num_batches <span style="box-sizing: border-box;color: rgb(249, 38, 114);">*</span> num_epochs] <span style="box-sizing: border-box;color: rgb(249, 38, 114);">+</span> list(ow<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>shape)<br/>)<br/>hw_series<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>shape</code></pre><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: 16px;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(0, 0, 0);text-align: start;'><code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>(5960, 4, 10)<br/></code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>迭代训练</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>i <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span><br/><span style="box-sizing: border-box;color: rgb(102, 217, 239);">for</span> e <span style="box-sizing: border-box;color: rgb(249, 38, 114);">in</span> tqdm(range(num_epochs)):<br/>    <span style="box-sizing: border-box;color: rgb(117, 113, 94);"># 每个 epoch 开始，洗牌训练样本</span><br/>    batch_indices <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>random<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>permutation(batch_indices)<br/>    <span style="box-sizing: border-box;color: rgb(102, 217, 239);">for</span> b <span style="box-sizing: border-box;color: rgb(249, 38, 114);">in</span> range(num_batches):<br/>        hw_series[i], hb, ow_series[i], ob <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> small_model<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>get_weights()<br/>        <span style="box-sizing: border-box;color: rgb(117, 113, 94);"># 根据一块训练数据执行一次更新</span><br/>        small_model<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>train_on_batch(<br/>            train_norm[batch_indices[b <span style="box-sizing: border-box;color: rgb(249, 38, 114);">*</span> batch_size: (b<span style="box-sizing: border-box;color: rgb(249, 38, 114);">+</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>) <span style="box-sizing: border-box;color: rgb(249, 38, 114);">*</span> batch_size]],<br/>            train_out[batch_indices[b <span style="box-sizing: border-box;color: rgb(249, 38, 114);">*</span> batch_size: (b<span style="box-sizing: border-box;color: rgb(249, 38, 114);">+</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>) <span style="box-sizing: border-box;color: rgb(249, 38, 114);">*</span> batch_size]],<br/>        )<br/>        i <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> i <span style="box-sizing: border-box;color: rgb(249, 38, 114);">+</span> <span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span></code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>下面是我们刚训练的神经网络模型的汇总信息</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>small_model<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>summary()</code></pre><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: 16px;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(0, 0, 0);text-align: start;'><code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>Model: "functional_1"<br/>_________________________________________________________________<br/>Layer (type)                 Output Shape              Param #<br/>=================================================================<br/>input_1 (InputLayer)         [(None, 4)]               0<br/>_________________________________________________________________<br/>dense (Dense)                (None, 10)                50<br/>_________________________________________________________________<br/>dense_1 (Dense)              (None, 1)                 11<br/>=================================================================<br/>Total params: 61<br/>Trainable params: 61<br/>Non-trainable params: 0<br/>_________________________________________________________________<br/></code></pre><h3 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.25rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>神经网络权重的演变</h3><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>现在我们将绘制神经网络权重的变化图。请注意，所有权重是如何在随机位置开始的，但是有些权重会随着时间发生显着变化。返回并以不同的学习率或批次大小重新训练网络。这如何改变权重的轨迹？</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>fig <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>figure(figsize<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span>(<span style="box-sizing: border-box;color: rgb(174, 129, 255);">12</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>))<br/>plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>subplot(<span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>)<br/><br/>hw_flat <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> hw_series<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>reshape(<br/>    hw_series<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>shape[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>],<br/>    hw_series<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>shape[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>] <span style="box-sizing: border-box;color: rgb(249, 38, 114);">*</span> hw_series<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>shape[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>]<br/>)<br/><br/><span style="box-sizing: border-box;color: rgb(102, 217, 239);">for</span> i <span style="box-sizing: border-box;color: rgb(249, 38, 114);">in</span> range(hw_flat<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>shape[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>]):<br/>    plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>plot(hw_flat[:, i])<br/>plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>xlabel(<span style="box-sizing: border-box;color: rgb(230, 219, 116);">"Step"</span>, fontsize<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">14</span>)<br/>plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>ylabel(<span style="box-sizing: border-box;color: rgb(230, 219, 116);">"Weight"</span>, fontsize<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">14</span>)<br/>plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>title(<span style="box-sizing: border-box;color: rgb(230, 219, 116);">"Hidden Layer Weights Optimized"</span>)<br/><br/>plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>subplot(<span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>)<br/>ow_flat <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> ow_series<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>reshape(<br/>    ow_series<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>shape[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>],<br/>    ow_series<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>shape[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>] <span style="box-sizing: border-box;color: rgb(249, 38, 114);">*</span> ow_series<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>shape[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>]<br/>)<br/><br/><span style="box-sizing: border-box;color: rgb(102, 217, 239);">for</span> i <span style="box-sizing: border-box;color: rgb(249, 38, 114);">in</span> range(ow_flat<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>shape[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>]):<br/>    plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>plot(ow_flat[:, i])<br/>plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>xlabel(<span style="box-sizing: border-box;color: rgb(230, 219, 116);">"Step"</span>, fontsize<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">14</span>)<br/>plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>ylabel(<span style="box-sizing: border-box;color: rgb(230, 219, 116);">"Weight"</span>, fontsize<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">14</span>)<br/>plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>title(<span style="box-sizing: border-box;color: rgb(230, 219, 116);">"Output Layer Weights Optimized"</span>)<br/>plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>show()</code></pre><figure style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'><img data-ratio="0.4540540540540541" data-src="https://mmbiz.qpic.cn/mmbiz_png/IpKhkdmFuGeJAzkhkIsbicrdpUbvHy3Mzy9gjfFXzoedFAPFj7xHiaZHjyvbfFmzbHR0KkMicXybNbjbYEW9Clvdg/640?wx_fmt=png" data-type="png" data-w="1480" src="20240525_021850_9.jpeg" style="box-sizing: border-box;vertical-align: bottom;display: inline;"/></figure><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>我们还可以通过调用 <code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding-right: 5px;padding-left: 5px;color: rgb(204, 51, 51);'>fit</code> 方法并指定时期数和批量大小来训练神经网络。</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>small_model<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>fit(<br/>    train_norm,<br/>    train_out,<br/>    epochs<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">10</span>,<br/>    batch_size<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">128</span>,<br/>)</code></pre><h2 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.5rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>结果</h2><h3 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.25rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>稠密神经网络检验</h3><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>现在，我们将计算一些检验分数，以确定神经网络的性能。我们将使用 3 个常见的摘要分数：</p><ul class="list-paddingleft-2" style='margin-bottom: 20px;list-style: square;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);margin-left: 0px;margin-right: 0px;'><li style="box-sizing: border-box;margin-bottom: 5px;"><p>Area Under the ROC Curve (AUC)：衡量模型在两个类别之间的区分程度，或最小化 false alarms 和 true negatives 的数量。</p></li><li style="box-sizing: border-box;margin-bottom: 5px;"><p>Brier Score：概率预测的均方误差。测量辨别力 (discrimination)，可靠性 (reliability) 和清晰度 (sharpness) 的组合。</p></li><li style="box-sizing: border-box;margin-bottom: 5px;"><p>Brier Skill Score：与始终按给定事件的观测相对频率进行预测相比，概率预测提高的百分比。</p></li></ul><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>预测测试集</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'><span style="box-sizing: border-box;color: rgb(249, 38, 114);">from</span> sklearn.metrics <span style="box-sizing: border-box;color: rgb(249, 38, 114);">import</span> (<br/>    mean_squared_error,<br/>    roc_auc_score<br/>)<br/><br/>small_model_preds <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> small_model<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>predict(test_norm)<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>ravel()<br/>small_model_preds</code></pre><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: 16px;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(0, 0, 0);text-align: start;'><code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>array([0.00285614, 0.0076969 , 0.05562624, ..., 0.00773937, 0.00463793,<br/>       0.00454199], dtype=float32)<br/></code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>AUC</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>small_model_auc <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> roc_auc_score(test_out, small_model_preds)<br/>small_model_auc</code></pre><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: 16px;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(0, 0, 0);text-align: start;'><code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>0.8876840181625545<br/></code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>Brier Score</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>small_model_brier_score <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> mean_squared_error(test_out, small_model_preds)<br/>small_model_brier_score</code></pre><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: 16px;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(0, 0, 0);text-align: start;'><code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>0.03896855574047458<br/></code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>Brier Skill Score</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>climo_brier_score <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> mean_squared_error(<br/>    test_out,<br/>    np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>ones(test_out<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>size) <span style="box-sizing: border-box;color: rgb(249, 38, 114);">*</span> test_out<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>sum() <span style="box-sizing: border-box;color: rgb(249, 38, 114);">/</span> test_out<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>size<br/>)<br/><br/>small_model_brier_skill_score <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> <span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span> <span style="box-sizing: border-box;color: rgb(249, 38, 114);">-</span> small_model_brier_score <span style="box-sizing: border-box;color: rgb(249, 38, 114);">/</span> climo_brier_score<br/>small_model_brier_skill_score</code></pre><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: 16px;background-color: rgb(245, 245, 245);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(0, 0, 0);text-align: start;'><code style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>0.21884305282434524<br/></code></pre><h3 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.25rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>神经网络内部可视化</h3><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>数据通过神经网络时会发生什么变化？</p><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>下面是给定一组输入字段的神经网络内部的静态和交互式可视化。彩色圆圈表示特定神经元的值。红色为正，蓝色为负。彩色线显示分配给每个连接的权重。深色线条的权重较大。</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'><span style="box-sizing: border-box;color: rgb(102, 217, 239);">def</span> <span style="box-sizing: border-box;color: rgb(166, 226, 46);">plot_neural_net</span>(<br/>    neural_net,<br/>    refl,<br/>    u10,<br/>    v10,<br/>    t2<br/>):<br/>    plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>figure(figsize<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span>(<span style="box-sizing: border-box;color: rgb(174, 129, 255);">8</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">6</span>))<br/>    <br/>    <span style="box-sizing: border-box;color: rgb(117, 113, 94);"># 值</span><br/>    nn_func <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> K<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>function(<br/>        [neural_net<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>input],<br/>        [<br/>            neural_net<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>layers[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>]<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>output,<br/>            neural_net<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>layers[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>]<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>output,<br/>        ]<br/>    )<br/>    h1_out, out_out <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> nn_func(<br/>        [np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>array([[refl, u10, v10, t2]])]<br/>    )<br/>    <br/>    <span style="box-sizing: border-box;color: rgb(117, 113, 94);"># 权重</span><br/>    h_weights <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> neural_net<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>layers[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>]<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>get_weights()[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>]<br/>    out_weights <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> neural_net<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>layers[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>]<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>get_weights()[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>]<br/>    <br/>    plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>axis(<span style="box-sizing: border-box;color: rgb(230, 219, 116);">"off"</span>)<br/>    <br/>    i1 <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span><br/>    <span style="box-sizing: border-box;color: rgb(102, 217, 239);">for</span> y1 <span style="box-sizing: border-box;color: rgb(249, 38, 114);">in</span> range(<span style="box-sizing: border-box;color: rgb(174, 129, 255);">3</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">7</span>):<br/>        <span style="box-sizing: border-box;color: rgb(117, 113, 94);"># 输入层：变量名</span><br/>        plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>text(<br/>            <span style="box-sizing: border-box;color: rgb(249, 38, 114);">-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">0.1</span>, y1,<br/>            input_columns[i1]<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>replace(<span style="box-sizing: border-box;color: rgb(230, 219, 116);">"_"</span>, <span style="box-sizing: border-box;color: rgb(230, 219, 116);">" "</span>),<br/>            ha<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">'right'</span>,<br/>            va<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">'center'</span>,<br/>            fontsize<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">12</span><br/>        )<br/>        <br/>        <span style="box-sizing: border-box;color: rgb(117, 113, 94);"># 输入层 -&gt; 隐藏层：权重</span><br/>        <span style="box-sizing: border-box;color: rgb(102, 217, 239);">for</span> y2 <span style="box-sizing: border-box;color: rgb(249, 38, 114);">in</span> range(<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">10</span>):<br/>            <span style="box-sizing: border-box;color: rgb(102, 217, 239);">if</span> h_weights[i1, y2] <span style="box-sizing: border-box;color: rgb(249, 38, 114);">&gt;</span> <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>:<br/>                color <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> [<span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>, np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>abs(h_weights[i1, y2]) <span style="box-sizing: border-box;color: rgb(249, 38, 114);">/</span> np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>abs(h_weights)<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>max()]<br/>            <span style="box-sizing: border-box;color: rgb(102, 217, 239);">else</span>:<br/>                color <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> [<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>, np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>abs(h_weights[i1, y2]) <span style="box-sizing: border-box;color: rgb(249, 38, 114);">/</span> np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>abs(h_weights)<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>max()]<br/>            plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>plot(<br/>                [<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>], [y1, y2],<br/>                linestyle<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">'-'</span>,<br/>                color<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span>color,<br/>                zorder<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span><br/>            )<br/>        i1 <span style="box-sizing: border-box;color: rgb(249, 38, 114);">+=</span> <span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span><br/>    <br/>    <span style="box-sizing: border-box;color: rgb(117, 113, 94);"># 隐藏层 -&gt; 输出层：权重</span><br/>    <span style="box-sizing: border-box;color: rgb(102, 217, 239);">for</span> y2 <span style="box-sizing: border-box;color: rgb(249, 38, 114);">in</span> range(<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">10</span>):<br/>        <span style="box-sizing: border-box;color: rgb(102, 217, 239);">if</span> out_weights[y2, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>] <span style="box-sizing: border-box;color: rgb(249, 38, 114);">&gt;</span> <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>:<br/>            color <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> (<span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>, np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>abs(out_weights[y2, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>] <span style="box-sizing: border-box;color: rgb(249, 38, 114);">/</span> np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>abs(out_weights)<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>max()))<br/>        <span style="box-sizing: border-box;color: rgb(102, 217, 239);">else</span>:<br/>            color <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> (<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>, np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>abs(out_weights[y2, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>] <span style="box-sizing: border-box;color: rgb(249, 38, 114);">/</span> np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>abs(out_weights)<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>max()))<br/>        plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>plot(<br/>            [<span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>], [y2, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>],<br/>            linestyle<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">'-'</span>,<br/>            color<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span>color,<br/>            zorder<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span><br/>        )<br/>    <br/>    <span style="box-sizing: border-box;color: rgb(117, 113, 94);"># 输入层：散点</span><br/>    plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>scatter(<br/>        np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>zeros(<span style="box-sizing: border-box;color: rgb(174, 129, 255);">4</span>),<br/>        np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>arange(<span style="box-sizing: border-box;color: rgb(174, 129, 255);">3</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">7</span>),<br/>        <span style="box-sizing: border-box;color: rgb(174, 129, 255);">100</span>,<br/>        np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>array([refl, u10, v10, t2]),<br/>        vmin<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>,<br/>        vmax<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>,<br/>        cmap<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">"RdBu_r"</span>,<br/>        edgecolor<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">'k'</span>,<br/>    )<br/>    <br/>    <span style="box-sizing: border-box;color: rgb(117, 113, 94);"># 隐藏层：散点</span><br/>    plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>scatter(<br/>        np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>ones(h1_out<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>size),<br/>        np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>arange(h1_out<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>size),<br/>        <span style="box-sizing: border-box;color: rgb(174, 129, 255);">100</span>,<br/>        h1_out<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>ravel(),<br/>        edgecolor<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">'k'</span>,<br/>        vmin<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>,<br/>        vmax<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>,<br/>        cmap<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">"RdBu_r"</span><br/>    )<br/>    <br/>    <span style="box-sizing: border-box;color: rgb(117, 113, 94);"># 隐藏层：值</span><br/>    <span style="box-sizing: border-box;color: rgb(102, 217, 239);">for</span> i <span style="box-sizing: border-box;color: rgb(249, 38, 114);">in</span> range(<span style="box-sizing: border-box;color: rgb(174, 129, 255);">10</span>):<br/>        plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>text(<br/>            <span style="box-sizing: border-box;color: rgb(174, 129, 255);">1.12</span>, i,<br/>            <span style="box-sizing: border-box;color: rgb(230, 219, 116);">"{0:0.2f}"</span><span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>format(h1_out<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>ravel()[i]),<br/>            ha<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">'center'</span>,<br/>            va<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">'center'</span>,<br/>            fontsize<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">12</span><br/>        )<br/>    <br/>    <span style="box-sizing: border-box;color: rgb(117, 113, 94);"># 输出层：散点</span><br/>    plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>scatter(<br/>        [<span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>],<br/>        [<span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>],<br/>        [<span style="box-sizing: border-box;color: rgb(174, 129, 255);">100</span>],<br/>        out_out[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>],<br/>        vmin<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>,<br/>        vmax<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>,<br/>        cmap<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">"RdBu_r"</span>,<br/>        edgecolor<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">'k'</span><br/>    )<br/>    <span style="box-sizing: border-box;color: rgb(117, 113, 94);"># 输出层：值</span><br/>    plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>text(<br/>        <span style="box-sizing: border-box;color: rgb(174, 129, 255);">2.12</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>,<span style="box-sizing: border-box;color: rgb(230, 219, 116);">"{0:0.2f}"</span><span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>format(out_out[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>]),<br/>        ha<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">'center'</span>,<br/>        va<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">'center'</span>,<br/>        fontsize<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">14</span><br/>    )</code></pre><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>示例</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>plot_neural_net(<br/>    small_model,<br/>    refl<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">4</span>,<br/>    u10<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>,<br/>    v10<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>,<br/>    t2<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">3</span><br/>)</code></pre><figure style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'><img data-ratio="0.5875754961173425" data-src="https://mmbiz.qpic.cn/mmbiz_png/IpKhkdmFuGeJAzkhkIsbicrdpUbvHy3Mz3qWyZJx1s2FHPHazFeF3B6vo7tCxmDNSYE9vibUicsUTf6vxKHKTSC5g/640?wx_fmt=png" data-type="png" data-w="1159" src="20240525_021851_10.jpeg" style="box-sizing: border-box;vertical-align: bottom;"/></figure><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>移动滑块以更改输出值。看看是否可以最大化强旋转的可能性。</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'><span style="box-sizing: border-box;color: rgb(249, 38, 114);">from</span> ipywidgets <span style="box-sizing: border-box;color: rgb(249, 38, 114);">import</span> interact<br/><span style="box-sizing: border-box;color: rgb(249, 38, 114);">import</span> ipywidgets <span style="box-sizing: border-box;color: rgb(249, 38, 114);">as</span> widgets<br/><br/>interact(<br/>    <span style="box-sizing: border-box;color: rgb(102, 217, 239);">lambda</span> refl, u10, v10, t2: plot_neural_net(small_model, refl, u10, v10, t2),<br/>    refl<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span>widgets<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>FloatSlider(min<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>, max<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>, step<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">0.1</span>),<br/>    u10<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span>widgets<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>FloatSlider(min<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>, max<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>, step<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">0.1</span>),<br/>    v10<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span>widgets<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>FloatSlider(min<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>, max<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>, step<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">0.1</span>),<br/>    t2<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span>widgets<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>FloatSlider(min<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>, max<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>, step<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">0.1</span>)<br/>);</code></pre><figure style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'><img data-ratio="0.790665751544269" data-src="https://mmbiz.qpic.cn/mmbiz_png/IpKhkdmFuGeJAzkhkIsbicrdpUbvHy3MztpXpyTmOMZJ18iblA21rucgforEd61icN4fxuj4siaznibAr0qnRobzs4Q/640?wx_fmt=png" data-type="png" data-w="1457" src="20240525_021852_11.jpeg" style="box-sizing: border-box;vertical-align: bottom;"/></figure><h3 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.25rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>神经网络梯度可视化</h3><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>当一组输入通过网络时，我们还可以绘制神经网络权重和值的梯度。将目标值从 0 更改为 1 时，梯度如何变化？改变每个输入字段如何影响整个网络的梯度？</p><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'><span style="box-sizing: border-box;color: rgb(102, 217, 239);">def</span> <span style="box-sizing: border-box;color: rgb(166, 226, 46);">plot_gradient</span>(<br/>    neural_net,<br/>    refl,<br/>    u10,<br/>    v10,<br/>    t2,<br/>    target_value,<br/>):<br/>    plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>figure(figsize<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span>(<span style="box-sizing: border-box;color: rgb(174, 129, 255);">8</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">6</span>))<br/>    nn_func <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> K<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>function(<br/>        [neural_net<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>input],<br/>        [<br/>            neural_net<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>layers[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>]<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>output,<br/>            neural_net<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>layers[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>]<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>output<br/>        ]<br/>    )<br/>    <br/>    target <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> K<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>placeholder(shape<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span>(<span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>,))<br/>    loss <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> K<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>mean((neural_net<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>output <span style="box-sizing: border-box;color: rgb(249, 38, 114);">-</span> target) <span style="box-sizing: border-box;color: rgb(249, 38, 114);">**</span> <span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>)<br/>    grads <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> K<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>gradients(<br/>        loss,<br/>        neural_net<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>layers[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>]<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>weights <span style="box-sizing: border-box;color: rgb(249, 38, 114);">+</span> neural_net<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>layers[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>]<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>weights <span style="box-sizing: border-box;color: rgb(249, 38, 114);">+</span> <br/>        [neural_net<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>layers[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>]<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>output, neural_net<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>input]<br/>    )<br/>    <br/>    grad_func <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> K<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>function(<br/>        [neural_net<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>input, target],<br/>        grads<br/>    )<br/>    <br/>    <span style="box-sizing: border-box;color: rgb(117, 113, 94);"># 值</span><br/>    h1_out, out_out <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> nn_func(<br/>        [np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>array([[refl, u10, v10, t2]])]<br/>    )<br/>    <br/>    <span style="box-sizing: border-box;color: rgb(117, 113, 94);"># 梯度</span><br/>    (<br/>        hidden_weight_grad,<br/>        hidden_bias_grad,<br/>        out_weight_grad,<br/>        out_bias_grad,<br/>        hidden_grad,<br/>        input_grad,<br/>    ) <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> grad_func(<br/>        [<br/>            np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>array([[refl, u10, v10, t2]]),<br/>            np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>array([target_value])<br/>        ]<br/>    )<br/>    <br/>    <span style="box-sizing: border-box;color: rgb(117, 113, 94);"># 权重</span><br/>    h_weights <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> neural_net<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>layers[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>]<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>get_weights()[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>]<br/>    out_weights <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> neural_net<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>layers[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>]<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>get_weights()[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>]<br/>    <br/>    plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>axis(<span style="box-sizing: border-box;color: rgb(230, 219, 116);">"off"</span>)<br/>    <br/>    i1 <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span><br/>    <span style="box-sizing: border-box;color: rgb(102, 217, 239);">for</span> y1 <span style="box-sizing: border-box;color: rgb(249, 38, 114);">in</span> range(<span style="box-sizing: border-box;color: rgb(174, 129, 255);">3</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">7</span>):<br/>        plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>text(<br/>            <span style="box-sizing: border-box;color: rgb(249, 38, 114);">-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">0.1</span>, y1,<br/>            input_columns[i1]<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>replace(<span style="box-sizing: border-box;color: rgb(230, 219, 116);">"_"</span>, <span style="box-sizing: border-box;color: rgb(230, 219, 116);">" "</span>),<br/>            ha<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">'right'</span>,<br/>            va<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">'center'</span>,<br/>            fontsize<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">12</span><br/>        )<br/>        <span style="box-sizing: border-box;color: rgb(102, 217, 239);">for</span> y2 <span style="box-sizing: border-box;color: rgb(249, 38, 114);">in</span> range(<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">10</span>):<br/>            <span style="box-sizing: border-box;color: rgb(102, 217, 239);">if</span> h_weights[i1, y2] <span style="box-sizing: border-box;color: rgb(249, 38, 114);">&lt;</span> <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>:<br/>                color <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> [<br/>                    <span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>,<br/>                    np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>abs(hidden_weight_grad[i1, y2]) <span style="box-sizing: border-box;color: rgb(249, 38, 114);">/</span> np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>abs(hidden_weight_grad)<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>max()<br/>                ]<br/>            <span style="box-sizing: border-box;color: rgb(102, 217, 239);">else</span>:<br/>                color <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> [<br/>                    <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>,<br/>                    np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>abs(hidden_weight_grad[i1, y2]) <span style="box-sizing: border-box;color: rgb(249, 38, 114);">/</span> np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>abs(hidden_weight_grad)<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>max()<br/>                ]<br/>            plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>plot(<br/>                [<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>], [y1, y2],<br/>                linestyle<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">'-'</span>,<br/>                color<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span>color,<br/>                zorder<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span><br/>            )<br/>        i1 <span style="box-sizing: border-box;color: rgb(249, 38, 114);">+=</span> <span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span><br/>        <br/>    <span style="box-sizing: border-box;color: rgb(102, 217, 239);">for</span> y2 <span style="box-sizing: border-box;color: rgb(249, 38, 114);">in</span> range(<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">10</span>):<br/>        <span style="box-sizing: border-box;color: rgb(102, 217, 239);">if</span> out_weights[y2, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>] <span style="box-sizing: border-box;color: rgb(249, 38, 114);">&lt;</span> <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>:<br/>            color <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> (<br/>                <span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>,<br/>                np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>abs(out_weight_grad[y2, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>] <span style="box-sizing: border-box;color: rgb(249, 38, 114);">/</span> np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>abs(out_weight_grad)<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>max())<br/>            )<br/>        <span style="box-sizing: border-box;color: rgb(102, 217, 239);">else</span>:<br/>            color <span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span> (<br/>                <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>,<br/>                np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>abs(out_weight_grad[y2, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>] <span style="box-sizing: border-box;color: rgb(249, 38, 114);">/</span> np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>abs(out_weight_grad)<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>max())<br/>            )<br/>        plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>plot(<br/>            [<span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>], [y2, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>],<br/>            linestyle<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">'-'</span>,<br/>            color<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span>color,<br/>            zorder<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span><br/>        )<br/>        <br/>    plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>scatter(<br/>        np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>zeros(<span style="box-sizing: border-box;color: rgb(174, 129, 255);">4</span>), np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>arange(<span style="box-sizing: border-box;color: rgb(174, 129, 255);">3</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">7</span>), <span style="box-sizing: border-box;color: rgb(174, 129, 255);">100</span>,<br/>        <span style="box-sizing: border-box;color: rgb(249, 38, 114);">-</span>input_grad<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>ravel() <span style="box-sizing: border-box;color: rgb(249, 38, 114);">/</span> np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>abs(input_grad)<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>max(),<br/>        vmin<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>,<br/>        vmax<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>,<br/>        cmap<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">"RdBu_r"</span>,<br/>        edgecolor<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">'k'</span>,<br/>    )<br/>    <br/>    plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>scatter(<br/>        np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>ones(h1_out<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>size), np<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>arange(h1_out<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>size), <span style="box-sizing: border-box;color: rgb(174, 129, 255);">100</span>,<br/>        <span style="box-sizing: border-box;color: rgb(249, 38, 114);">-</span>hidden_grad<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>ravel(),<br/>        edgecolor<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">'k'</span>,<br/>        vmin<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>,<br/>        vmax<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>,<br/>        cmap<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">"RdBu_r"</span><br/>    )<br/>    <br/>    <span style="box-sizing: border-box;color: rgb(102, 217, 239);">for</span> i <span style="box-sizing: border-box;color: rgb(249, 38, 114);">in</span> range(<span style="box-sizing: border-box;color: rgb(174, 129, 255);">10</span>):<br/>        plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>text(<br/>            <span style="box-sizing: border-box;color: rgb(174, 129, 255);">1.2</span>, i,<br/>            <span style="box-sizing: border-box;color: rgb(230, 219, 116);">"{0:0.5f}"</span><span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>format(<span style="box-sizing: border-box;color: rgb(249, 38, 114);">-</span>hidden_grad<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>ravel()[i]),<br/>            ha<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">'center'</span>,<br/>            va<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">'center'</span>,<br/>            fontsize<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">12</span><br/>        )<br/>    plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>scatter(<br/>        [<span style="box-sizing: border-box;color: rgb(174, 129, 255);">2</span>], [<span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>], [<span style="box-sizing: border-box;color: rgb(174, 129, 255);">100</span>],<br/>        out_out[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>],<br/>        vmin<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>,<br/>        vmax<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>,<br/>        cmap<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">"RdBu_r"</span>,<br/>        edgecolor<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">'k'</span><br/>    )<br/>    <br/>    plt<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>text(<br/>        <span style="box-sizing: border-box;color: rgb(174, 129, 255);">2.12</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>,<br/>        <span style="box-sizing: border-box;color: rgb(230, 219, 116);">"{0:0.2f}"</span><span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>format(out_out[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>]),<br/>        ha<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">'center'</span>,<br/>        va<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(230, 219, 116);">'center'</span>,<br/>        fontsize<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">14</span><br/>    )</code></pre><pre style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background-color: rgb(39, 40, 34);border-width: 1px;border-style: solid;border-color: rgb(235, 235, 235);padding: 1.25rem;margin-bottom: 1.25rem;overflow: auto;color: rgb(248, 248, 242);tab-size: 4;'><code data-lang="py" style='box-sizing: border-box;font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size: inherit;background: inherit;border-width: 0px;border-style: initial;border-color: initial;color: inherit;white-space: inherit;'>interact(<br/>    <span style="box-sizing: border-box;color: rgb(102, 217, 239);">lambda</span> refl, u10, v10, t2, target_value:<br/>        plot_gradient(<br/>            small_model, refl, u10, v10, t2, target_value<br/>        ),<br/>    refl<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span>widgets<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>FloatSlider(value<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">1.0</span>, min<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>, max<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>, step<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">0.1</span>),<br/>    u10<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span>widgets<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>FloatSlider(value<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">1.0</span>,min<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>, max<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>, step<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">0.1</span>),<br/>    v10<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span>widgets<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>FloatSlider(value<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">1.0</span>, min<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>, max<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>, step<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">0.1</span>),<br/>    t2<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span>widgets<span style="box-sizing: border-box;color: rgb(249, 38, 114);">.</span>FloatSlider(value<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">1.0</span>, min<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=-</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>, max<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">5</span>, step<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span><span style="box-sizing: border-box;color: rgb(174, 129, 255);">0.1</span>),<br/>    target_value<span style="box-sizing: border-box;color: rgb(249, 38, 114);">=</span>[<span style="box-sizing: border-box;color: rgb(174, 129, 255);">0</span>, <span style="box-sizing: border-box;color: rgb(174, 129, 255);">1</span>]<br/>);</code></pre><figure style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'><img data-ratio="0.8297730307076101" data-src="https://mmbiz.qpic.cn/mmbiz_png/IpKhkdmFuGeJAzkhkIsbicrdpUbvHy3MzvE9j5xy9ic7oxR270DgdWxf0dAlMdmiaxUz5osyNr2GtW84Td6F0rcxQ/640?wx_fmt=png" data-type="png" data-w="1498" src="20240525_021853_12.jpeg" style="box-sizing: border-box;vertical-align: bottom;"/></figure><h2 style='box-sizing: border-box;margin-bottom: 1.25rem;font-weight: 700;line-height: 1.3;color: rgb(0, 0, 0);font-size: 1.5rem;font-family: "Open Sans", Helvetica, Arial, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>参考</h2><p style='box-sizing: border-box;margin-bottom: 1.25rem;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);'>https://github.com/djgagne/ams-ml-python-course</p><p style='margin-bottom: 1.25rem;white-space: normal;box-sizing: border-box;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;background-color: rgb(255, 255, 255);'><span style="font-size: 17px;font-weight: 700;">AMS 机器学习课程</span></p><p style='margin-bottom: 1.25rem;white-space: normal;box-sizing: border-box;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;background-color: rgb(255, 255, 255);'><span style="box-sizing: border-box;font-style: inherit;font-variant: inherit;font-stretch: inherit;font-size: inherit;line-height: inherit;font-family: inherit;font-weight: 700;"></span></p><p style='margin-bottom: 1.25rem;white-space: normal;box-sizing: border-box;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;background-color: rgb(255, 255, 255);'><span style="font-size: 17px;">数据预处理：</span></p><p style='margin-bottom: 1.25rem;white-space: normal;box-sizing: border-box;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;background-color: rgb(255, 255, 255);'><span style="font-size: 17px;">《</span><a data-itemshowtype="0" data-linktype="2" href="#" style="font-size: 17px;" tab="innerlink" target="_blank">数据分析与预处理 - 读取数据</a><span style="font-size: 17px;">》</span></p><p style='margin-bottom: 1.25rem;white-space: normal;box-sizing: border-box;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;background-color: rgb(255, 255, 255);'><span style="font-size: 17px;">《</span><a data-itemshowtype="0" data-linktype="2" href="#" style="font-size: 17px;" tab="innerlink" target="_blank">数据分析与预处理 - 数据变换与可视化</a><span style="font-size: 17px;">》</span></p><p style='margin-bottom: 1.25rem;white-space: normal;box-sizing: border-box;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;background-color: rgb(255, 255, 255);'><span style="font-size: 17px;">《</span><a data-itemshowtype="0" data-linktype="2" href="#" style="font-size: 17px;" tab="innerlink" target="_blank">数据分析与预处理 - 准备数据</a><span style="font-size: 17px;">》</span></p><p style='margin-bottom: 1.25rem;white-space: normal;box-sizing: border-box;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;background-color: rgb(255, 255, 255);'><span style="font-size: 17px;">实际数据处理：</span></p><p style='margin-bottom: 1.25rem;white-space: normal;box-sizing: border-box;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;background-color: rgb(255, 255, 255);'><span style="font-size: 17px;">《</span><a data-itemshowtype="0" data-linktype="2" href="#" style="font-size: 17px;" tab="innerlink" target="_blank" textvalue="AMS机器学习课程：预测雷暴旋转的基础机器学习 - 数据">预测雷暴旋转的基础机器学习 - 数据</a><span style="font-size: 17px;">》</span></p><p style='margin-bottom: 1.25rem;white-space: normal;box-sizing: border-box;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;background-color: rgb(255, 255, 255);'><span style="font-size: 17px;">线性回归：</span></p><p style='margin-bottom: 1.25rem;white-space: normal;box-sizing: border-box;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;background-color: rgb(255, 255, 255);'><span style="font-size: 17px;">《</span><a data-itemshowtype="0" data-linktype="2" href="#" style="font-size: 17px;" tab="innerlink" target="_blank" textvalue="AMS机器学习课程：预测雷暴旋转的基础机器学习 - 线性回归">预测雷暴旋转的基础机器学习 - 线性回归</a><span style="font-size: 17px;">》</span></p><p style='margin-bottom: 1.25rem;white-space: normal;box-sizing: border-box;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;background-color: rgb(255, 255, 255);'><span style="font-size: 17px;">《</span><a data-itemshowtype="0" data-linktype="2" href="#" style="font-size: 17px;" tab="innerlink" target="_blank" textvalue="预测雷暴旋转的基础机器学习 - 正则化">预测雷暴旋转的基础机器学习 - 正则化</a><span style="font-size: 17px;">》</span></p><p style='margin-bottom: 1.25rem;white-space: normal;box-sizing: border-box;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;background-color: rgb(255, 255, 255);'><span style="font-size: 17px;">《</span><a data-itemshowtype="0" data-linktype="2" href="#" style="font-size: 17px;" tab="innerlink" target="_blank" textvalue="预测雷暴旋转的基础机器学习 - 超参数试验">预测雷暴旋转的基础机器学习 - 超参数试验</a><span style="font-size: 17px;">》</span></p><p style='margin-bottom: 1.25rem;white-space: normal;box-sizing: border-box;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;background-color: rgb(255, 255, 255);'><span style="font-size: 17px;">逻辑回归：</span></p><p style='margin-bottom: 1.25rem;white-space: normal;box-sizing: border-box;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;background-color: rgb(255, 255, 255);'><span style="font-size: 17px;">《</span><a data-itemshowtype="0" data-linktype="2" href="#" style="font-size: 17px;" tab="innerlink" target="_blank" textvalue="预测雷暴旋转的基础机器学习：分类 - 训练">预测雷暴旋转的基础机器学习：分类 - 训练</a><span style="font-size: 17px;">》</span></p><p style='margin-bottom: 1.25rem;white-space: normal;box-sizing: border-box;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;background-color: rgb(255, 255, 255);'><span style="font-size: 17px;">《</span><a data-itemshowtype="0" data-linktype="2" href="#" style="font-size: 17px;" tab="innerlink" target="_blank" textvalue="预测雷暴旋转的基础机器学习：分类 - ROC 曲线">预测雷暴旋转的基础机器学习：分类 - ROC 曲线</a><span style="font-size: 17px;">》</span></p><p style='margin-bottom: 1.25rem;white-space: normal;box-sizing: border-box;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;background-color: rgb(255, 255, 255);'><span style="font-size: 17px;">《</span><a data-itemshowtype="0" data-linktype="2" href="#" style="font-size: 17px;" tab="innerlink" target="_blank" textvalue="预测雷暴旋转的基础机器学习：分类 - 性能图">预测雷暴旋转的基础机器学习：分类 - 性能图</a><span style="font-size: 17px;">》</span></p><p style='margin-bottom: 1.25rem;white-space: normal;box-sizing: border-box;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;background-color: rgb(255, 255, 255);'><span style="font-size: 17px;">《</span><a data-itemshowtype="0" data-linktype="2" href="#" style="font-size: 17px;" tab="innerlink" target="_blank" textvalue="预测雷暴旋转的基础机器学习：分类 - 属性图">预测雷暴旋转的基础机器学习：分类 - 属性图</a><span style="font-size: 17px;">》</span></p><p style="white-space: normal;">《<a data-itemshowtype="0" data-linktype="2" href="#" tab="innerlink" target="_blank">预测雷暴旋转的基础机器学习：分类 - 评估</a>》</p><p style="white-space: normal;"><br/></p><p style="margin-bottom: 1.25rem;white-space: normal;box-sizing: border-box;">《<a data-itemshowtype="0" data-linktype="2" href="#" tab="innerlink" target="_blank" textvalue="预测雷暴旋转的基础机器学习：分类 - 系数与正则化">预测雷暴旋转的基础机器学习：分类 - 系数与正则化</a>》</p><p style='margin-bottom: 1.25rem;white-space: normal;box-sizing: border-box;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;background-color: rgb(255, 255, 255);'>决策树：</p><p style='margin-bottom: 1.25rem;white-space: normal;box-sizing: border-box;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;background-color: rgb(255, 255, 255);'>《<a data-itemshowtype="0" data-linktype="2" href="#" tab="innerlink" target="_blank" textvalue="预测雷暴旋转的基础机器学习：分类 - 决策树">预测雷暴旋转的基础机器学习：分类 - 决策树</a>》</p><p style='margin-bottom: 1.25rem;white-space: normal;box-sizing: border-box;color: rgb(0, 0, 0);font-family: "Open Sans", Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;background-color: rgb(255, 255, 255);'>《<a data-itemshowtype="0" data-linktype="2" href="#" tab="innerlink" target="_blank" textvalue="预测雷暴旋转的基础机器学习：分类 - 决策树超参数试验">预测雷暴旋转的基础机器学习：分类 - 决策树超参数试验</a>》</p><p><span style="font-size: 16px;">《</span><a data-itemshowtype="0" data-linktype="2" href="#" style="font-size: 16px;" tab="innerlink" target="_blank"><span style="font-size: 16px;">预测雷暴旋转的基础机器学习：分类 - 决策树集成学习</span></a><span style="font-size: 16px;">》</span><br/></p><p><span style="font-size: 16px;"><br/></span></p><hr style="border-style: solid;border-width: 1px 0 0;border-color: rgba(0,0,0,0.1);-webkit-transform-origin: 0 0;-webkit-transform: scale(1, 0.5);transform-origin: 0 0;transform: scale(1, 0.5);"/><p><span style="font-size: 16px;"></span><br/></p><p style="text-align: center;"></p><section style="margin-top: 20px;">题图由 JUNO KWON 在 Pixabay 上发布。</section></div>

</div>
                <p></p>
                <p></p>
                <div>本文由“公众号文章抓取器”生成，请忽略上文所有联系方式或指引式信息。有问题可以联系：五人工作室，官网：www.Wuren.Work，QQ微信同号1976.424.585 </div>
                <div  class="hidden">本文由“公众号文章抓取器”生成，请忽略上文所有联系方式或指引式信息。有问题可以联系：五人工作室，官网：www.Wuren.Work，QQ微信同号1976.424.585 <br><p class="hidden">code/s?__biz=MzAxNjIxMjg5MQ==&mid=2247485267&idx=1&sn=f1e6f5fc34f5d74b37c79218e94ba254&chksm=9bf971a7ac8ef8b13e63242965df8fde09daf98c7d4410d72468255e3ccd88aa37111abe3889#rd </p></div>
            </body>
            </html>
            