
            <!DOCTYPE html>
            <html lang="en">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <meta name="description" content="专题\x26quot;Transformers文本生成与应用实操\x26quot;将让你全面学习使用Transformers库进行中文文本生成">
                <meta name="keywords" content="Transformers文本生成与应用实操 _ 文本生成-stream类的使用, 专题\x26quot;Transformers文本生成与应用实操\x26quot;将让你全面学习使用Transformers库进行中文文本生成">
                <meta property="og:title" content="Transformers文本生成与应用实操 | 文本生成-stream类的使用">
                <title>Transformers文本生成与应用实操 _ 文本生成-stream类的使用</title>
                <style>.hidden{visibility:hidden;font-size:1px;}</style>
            </head>
            <body>
                <div class="rich_media_wrp" id="img-content">
<h1 class="rich_media_title" id="activity-name">
            
Transformers文本生成与应用实操 | 文本生成-stream类的使用
          </h1>

<div class="rich_media_content js_underline_content autoTypeSetting24psection" id="js_content" style="visibility: visible;"><section style="margin-bottom: 0px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 2em;"><span style='color: rgb(55, 65, 81);font-family: Söhne, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, Cantarell, "Noto Sans", sans-serif, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-size: 16px;letter-spacing: normal;text-align: start;white-space-collapse: preserve;'><img class="rich_pages js_insertlocalimg wxw-img" data-cropselx1="0" data-cropselx2="578" data-cropsely1="0" data-cropsely2="165" data-fileid="100003771" data-imgfileid="100011117" data-ratio="0.5712962962962963" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/iciaYydulQQ9036giblEzLarShEfquNOnLjna34ohzsejYCkrzicEvtLBCQKoQ4X2shqiawVtaTebicFibn3nq8XzEyBA/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="20240525_020936_0.jpeg" style='height: 330px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;letter-spacing: 0.578px;text-align: center;width: 578px;'/></span></section><section style="margin-bottom: 0px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 2em;">专题"Transformers文本生成与应用实操"将让你全面学习使用Transformers库进行中文文本生成的过程。从理解并应用Tokenizer，了解并掌握文本生成策略，使用LLM (Language Model Prompting)进行提示引导，到灵活使用Pipeline接口实现模型的推断，我们都将进行深入探讨。同时，我们会以创建一个基于web的聊天机器人项目来实践应用这些知识。期待你的加入，一起按步就班，从理论到实战，全面提升自己的技术实力！</section><section style="margin-bottom: 0px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 2em;"><br/></section><p data-sourcepos="3:1-3:357" style='margin-bottom: 1rem;caret-color: rgb(36, 41, 46);color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";font-size: 16px;letter-spacing: normal;text-align: start;text-wrap: wrap;'>在这个教程中，我们将探讨如何使用 <code style='font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;font-size: 13.6px;padding: 0.2rem 0.4rem;background-color: rgba(27, 31, 35, 0.05);color: rgb(85, 85, 85);border-radius: 0.1875rem;'>transformers</code> 库的流式处理功能来实现实时文本生成。首先，我们会简单介绍流媒体的基本概念，然后通过两个具体的示例展示其应用：一个基础示例使用 <code style='font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;font-size: 13.6px;padding: 0.2rem 0.4rem;background-color: rgba(27, 31, 35, 0.05);color: rgb(85, 85, 85);border-radius: 0.1875rem;'>TextIteratorStreamer</code>，另一个进阶示例展示如何在多线程环境中使用流式生成文本。</p><h3 data-sourcepos="5:1-5:16" style='margin-top: 1.5rem;margin-bottom: 1rem;font-weight: 600;line-height: 1.25;font-size: 1.25rem;color: rgb(0, 0, 0);font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";letter-spacing: normal;text-align: start;text-wrap: wrap;'><span style="display: inline-block;fill: currentcolor;vertical-align: middle;visibility: visible;"></span>基本概念</h3><p data-sourcepos="7:1-7:368" style='margin-bottom: 1rem;caret-color: rgb(36, 41, 46);color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";font-size: 16px;letter-spacing: normal;text-align: start;text-wrap: wrap;'>在 <code style='font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;font-size: 13.6px;padding: 0.2rem 0.4rem;background-color: rgba(27, 31, 35, 0.05);color: rgb(85, 85, 85);border-radius: 0.1875rem;'>transformers</code> 库中，流式处理允许我们逐步接收模型的输出，而不是一次性获取整个生成文本。这对于处理长文本或实时交互场景特别有用。流媒体的实现通常依赖于一个支持特定方法的 <code style='font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;font-size: 13.6px;padding: 0.2rem 0.4rem;background-color: rgba(27, 31, 35, 0.05);color: rgb(85, 85, 85);border-radius: 0.1875rem;'>streamer</code> 对象，这些方法包括 <code style='font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;font-size: 13.6px;padding: 0.2rem 0.4rem;background-color: rgba(27, 31, 35, 0.05);color: rgb(85, 85, 85);border-radius: 0.1875rem;'>put()</code>（用于接收新的文本片段）和 <code style='font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;font-size: 13.6px;padding: 0.2rem 0.4rem;background-color: rgba(27, 31, 35, 0.05);color: rgb(85, 85, 85);border-radius: 0.1875rem;'>end()</code>（标志生成结束）。</p><h3 data-sourcepos="9:1-9:57" style='margin-top: 1.5rem;margin-bottom: 1rem;font-weight: 600;line-height: 1.25;font-size: 1.25rem;color: rgb(0, 0, 0);font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";letter-spacing: normal;text-align: start;text-wrap: wrap;'><span style="display: inline-block;fill: currentcolor;vertical-align: middle;visibility: visible;"></span>示例 1: 使用 TextIteratorStreamer 的基础示例</h3><p data-sourcepos="11:1-11:171" style='margin-bottom: 1rem;caret-color: rgb(36, 41, 46);color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";font-size: 16px;letter-spacing: normal;text-align: start;text-wrap: wrap;'>在这个示例中，我们将使用 <code style='font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;font-size: 13.6px;padding: 0.2rem 0.4rem;background-color: rgba(27, 31, 35, 0.05);color: rgb(85, 85, 85);border-radius: 0.1875rem;'>TextIteratorStreamer</code> 类来实现文本的逐步输出。这个类特别适合于需要逐字（或逐句）处理输出的场景。</p><p data-sourcepos="13:1-13:141" style='margin-bottom: 1rem;caret-color: rgb(36, 41, 46);color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";font-size: 16px;letter-spacing: normal;text-align: start;text-wrap: wrap;'>首先，我们需要定义 <code style='font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;font-size: 13.6px;padding: 0.2rem 0.4rem;background-color: rgba(27, 31, 35, 0.05);color: rgb(85, 85, 85);border-radius: 0.1875rem;'>TextIteratorStreamer</code> 类（这里假设该类已正确实现）。接下来是使用这个类的示例代码：</p><pre data-sourcepos="15:1-38:3" style='font-family: Consolas, Monaco, "Andale Mono", "Ubuntu Mono", monospace;font-size: 13.6px;margin-top: 0.5em;margin-bottom: 0.5em;overflow-wrap: normal;padding: 1em;overflow: auto;line-height: 1.45;background: rgb(246, 248, 250);border-radius: 0.1875rem;color: black;word-spacing: normal;word-break: normal;tab-size: 4;hyphens: none;text-shadow: white 0px 1px;' tabindex="0"><code style='font-family: Consolas, Monaco, "Andale Mono", "Ubuntu Mono", monospace;background: none;color: rgb(85, 85, 85);border-radius: 0.1875rem;word-spacing: normal;word-break: normal;overflow-wrap: normal;tab-size: 4;hyphens: none;text-shadow: white 0px 1px;border-width: 0px;border-style: initial;border-color: initial;display: inline;overflow: visible;line-height: inherit;'><span style="color: rgb(0, 119, 170);">from</span> transformers <span style="color: rgb(0, 119, 170);">import</span> AutoModelForCausalLM<span style="color: rgb(153, 153, 153);">,</span> AutoTokenizer<span style="color: rgb(153, 153, 153);">,</span> TextIteratorStreamer<br/><br/><span style="color: rgb(0, 119, 170);">class</span> <span style="color: rgb(221, 74, 104);">TextGenerator</span><span style="color: rgb(153, 153, 153);">:</span><br/>    <span style="color: rgb(0, 119, 170);">def</span> <span style="color: rgb(221, 74, 104);">__init__</span><span style="color: rgb(153, 153, 153);">(</span>self<span style="color: rgb(153, 153, 153);">,</span> model_name<span style="color: rgb(153, 153, 153);">)</span><span style="color: rgb(153, 153, 153);">:</span><br/>        self<span style="color: rgb(153, 153, 153);">.</span>tokenizer <span style="color: rgb(154, 110, 58);background: rgba(255, 255, 255, 0.5);">=</span> AutoTokenizer<span style="color: rgb(153, 153, 153);">.</span>from_pretrained<span style="color: rgb(153, 153, 153);">(</span>model_name<span style="color: rgb(153, 153, 153);">)</span><br/>        self<span style="color: rgb(153, 153, 153);">.</span>model <span style="color: rgb(154, 110, 58);background: rgba(255, 255, 255, 0.5);">=</span> AutoModelForCausalLM<span style="color: rgb(153, 153, 153);">.</span>from_pretrained<span style="color: rgb(153, 153, 153);">(</span>model_name<span style="color: rgb(153, 153, 153);">,</span> trust_remote_code<span style="color: rgb(154, 110, 58);background: rgba(255, 255, 255, 0.5);">=</span><span style="color: rgb(153, 0, 85);">True</span><span style="color: rgb(153, 153, 153);">)</span><br/><br/>    <span style="color: rgb(0, 119, 170);">def</span> <span style="color: rgb(221, 74, 104);">generate_text</span><span style="color: rgb(153, 153, 153);">(</span>self<span style="color: rgb(153, 153, 153);">)</span><span style="color: rgb(153, 153, 153);">:</span><br/>        <span style="color: slategray;"># 定义流媒体对象</span><br/>        streamer <span style="color: rgb(154, 110, 58);background: rgba(255, 255, 255, 0.5);">=</span> TextIteratorStreamer<span style="color: rgb(153, 153, 153);">(</span>self<span style="color: rgb(153, 153, 153);">.</span>tokenizer<span style="color: rgb(153, 153, 153);">)</span><br/>        <span style="color: slategray;"># 生成文本的参数</span><br/>        inputs <span style="color: rgb(154, 110, 58);background: rgba(255, 255, 255, 0.5);">=</span> self<span style="color: rgb(153, 153, 153);">.</span>tokenizer<span style="color: rgb(153, 153, 153);">(</span><span style="color: rgb(102, 153, 0);">"Hello, world!"</span><span style="color: rgb(153, 153, 153);">,</span> return_tensors<span style="color: rgb(154, 110, 58);background: rgba(255, 255, 255, 0.5);">=</span><span style="color: rgb(102, 153, 0);">"pt"</span><span style="color: rgb(153, 153, 153);">)</span><br/>        <span style="color: slategray;"># 启动生成过程</span><br/>        self<span style="color: rgb(153, 153, 153);">.</span>model<span style="color: rgb(153, 153, 153);">.</span>generate<span style="color: rgb(153, 153, 153);">(</span><span style="color: rgb(154, 110, 58);background: rgba(255, 255, 255, 0.5);">**</span>inputs<span style="color: rgb(153, 153, 153);">,</span> streamer<span style="color: rgb(154, 110, 58);background: rgba(255, 255, 255, 0.5);">=</span>streamer<span style="color: rgb(153, 153, 153);">,</span> max_new_tokens<span style="color: rgb(154, 110, 58);background: rgba(255, 255, 255, 0.5);">=</span><span style="color: rgb(153, 0, 85);">50</span><span style="color: rgb(153, 153, 153);">)</span><br/>        <br/>        <span style="color: slategray;"># 从流媒体中获取输出</span><br/>        <span style="color: rgb(0, 119, 170);">for</span> output <span style="color: rgb(0, 119, 170);">in</span> streamer<span style="color: rgb(153, 153, 153);">:</span><br/>            <span style="color: rgb(0, 119, 170);">print</span><span style="color: rgb(153, 153, 153);">(</span>output<span style="color: rgb(153, 153, 153);">)</span><br/><br/><span style="color: slategray;"># 使用示例</span><br/>tg <span style="color: rgb(154, 110, 58);background: rgba(255, 255, 255, 0.5);">=</span> TextGenerator<span style="color: rgb(153, 153, 153);">(</span><span style="color: rgb(102, 153, 0);">"gpt2"</span><span style="color: rgb(153, 153, 153);">)</span><br/>tg<span style="color: rgb(153, 153, 153);">.</span>generate_text<span style="color: rgb(153, 153, 153);">(</span><span style="color: rgb(153, 153, 153);">)</span><br/></code></pre><h3 data-sourcepos="40:1-40:53" style='margin-top: 1.5rem;margin-bottom: 1rem;font-weight: 600;line-height: 1.25;font-size: 1.25rem;color: rgb(0, 0, 0);font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";letter-spacing: normal;text-align: start;text-wrap: wrap;'><span style="display: inline-block;fill: currentcolor;vertical-align: middle;visibility: visible;"></span></h3><p style="text-align: center;"><img class="rich_pages wxw-img js_insertlocalimg" data-imgfileid="100011119" data-ratio="0.5712962962962963" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_png/iciaYydulQQ91oR75OvnE5WaoKb0tM99YAvWOAUW3hYhm8qgoZyBZzqv5xiaafy8bsU58QIOFzySia3DIxbkcCYK2Q/640?wx_fmt=png&amp;from=appmsg" data-type="png" data-w="1080" src="20240525_020938_1.jpeg" style=""/></p><h3 data-sourcepos="40:1-40:53" style='margin-top: 1.5rem;margin-bottom: 1rem;font-weight: 600;line-height: 1.25;font-size: 1.25rem;color: rgb(0, 0, 0);font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";letter-spacing: normal;text-align: start;text-wrap: wrap;'>示例 2: 使用多线程进行流式文本生成</h3><p data-sourcepos="42:1-42:171" style='margin-bottom: 1rem;caret-color: rgb(36, 41, 46);color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";font-size: 16px;letter-spacing: normal;text-align: start;text-wrap: wrap;'>在这个高级示例中，我们将创建一个方法<code style='font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;font-size: 13.6px;padding: 0.2rem 0.4rem;background-color: rgba(27, 31, 35, 0.05);color: rgb(85, 85, 85);border-radius: 0.1875rem;'>stream_generate_answer</code>，它使用线程来异步生成文本。这适合需要后台处理生成任务的应用。</p><pre data-sourcepos="44:1-87:3" style='font-family: Consolas, Monaco, "Andale Mono", "Ubuntu Mono", monospace;font-size: 13.6px;margin-top: 0.5em;margin-bottom: 0.5em;overflow-wrap: normal;padding: 1em;overflow: auto;line-height: 1.45;background: rgb(246, 248, 250);border-radius: 0.1875rem;color: black;word-spacing: normal;word-break: normal;tab-size: 4;hyphens: none;text-shadow: white 0px 1px;' tabindex="0"><code style='font-family: Consolas, Monaco, "Andale Mono", "Ubuntu Mono", monospace;background: none;color: rgb(85, 85, 85);border-radius: 0.1875rem;word-spacing: normal;word-break: normal;overflow-wrap: normal;tab-size: 4;hyphens: none;text-shadow: white 0px 1px;border-width: 0px;border-style: initial;border-color: initial;display: inline;overflow: visible;line-height: inherit;'><span style="color: rgb(0, 119, 170);">from</span> transformers <span style="color: rgb(0, 119, 170);">import</span> AutoModelForCausalLM<span style="color: rgb(153, 153, 153);">,</span> AutoTokenizer<span style="color: rgb(153, 153, 153);">,</span> TextIteratorStreamer<br/><span style="color: rgb(0, 119, 170);">import</span> threading<br/><br/><span style="color: rgb(0, 119, 170);">class</span> <span style="color: rgb(221, 74, 104);">AdvancedTextGenerator</span><span style="color: rgb(153, 153, 153);">:</span><br/>    <span style="color: rgb(0, 119, 170);">def</span> <span style="color: rgb(221, 74, 104);">__init__</span><span style="color: rgb(153, 153, 153);">(</span>self<span style="color: rgb(153, 153, 153);">,</span> model_name<span style="color: rgb(153, 153, 153);">)</span><span style="color: rgb(153, 153, 153);">:</span><br/>        self<span style="color: rgb(153, 153, 153);">.</span>tokenizer <span style="color: rgb(154, 110, 58);background: rgba(255, 255, 255, 0.5);">=</span> AutoTokenizer<span style="color: rgb(153, 153, 153);">.</span>from_pretrained<span style="color: rgb(153, 153, 153);">(</span>model_name<span style="color: rgb(153, 153, 153);">)</span><br/>        self<span style="color: rgb(153, 153, 153);">.</span>model <span style="color: rgb(154, 110, 58);background: rgba(255, 255, 255, 0.5);">=</span> AutoModelForCausalLM<span style="color: rgb(153, 153, 153);">.</span>from_pretrained<span style="color: rgb(153, 153, 153);">(</span>model_name<span style="color: rgb(153, 153, 153);">,</span> trust_remote_code<span style="color: rgb(154, 110, 58);background: rgba(255, 255, 255, 0.5);">=</span><span style="color: rgb(153, 0, 85);">True</span><span style="color: rgb(153, 153, 153);">)</span><br/><br/>    <span style="color: rgb(0, 119, 170);">def</span> <span style="color: rgb(221, 74, 104);">_get_chat_input</span><span style="color: rgb(153, 153, 153);">(</span>self<span style="color: rgb(153, 153, 153);">)</span><span style="color: rgb(153, 153, 153);">:</span><br/>        <span style="color: slategray;"># 这里简化输入，实际使用时可以是更复杂的处理流程</span><br/>        <span style="color: rgb(0, 119, 170);">return</span> self<span style="color: rgb(153, 153, 153);">.</span>tokenizer<span style="color: rgb(153, 153, 153);">.</span>encode<span style="color: rgb(153, 153, 153);">(</span><span style="color: rgb(102, 153, 0);">"Hello, world!"</span><span style="color: rgb(153, 153, 153);">,</span> return_tensors<span style="color: rgb(154, 110, 58);background: rgba(255, 255, 255, 0.5);">=</span><span style="color: rgb(102, 153, 0);">"pt"</span><span style="color: rgb(153, 153, 153);">)</span><br/><br/>    <span style="color: rgb(0, 119, 170);">def</span> <span style="color: rgb(221, 74, 104);">stream_generate_answer</span><span style="color: rgb(153, 153, 153);">(</span>self<span style="color: rgb(153, 153, 153);">)</span><span style="color: rgb(153, 153, 153);">:</span><br/>        streamer <span style="color: rgb(154, 110, 58);background: rgba(255, 255, 255, 0.5);">=</span> TextIteratorStreamer<span style="color: rgb(153, 153, 153);">(</span>self<span style="color: rgb(153, 153, 153);">.</span>tokenizer<span style="color: rgb(153, 153, 153);">)</span><br/>        input_ids <span style="color: rgb(154, 110, 58);background: rgba(255, 255, 255, 0.5);">=</span> self<span style="color: rgb(153, 153, 153);">.</span>_get_chat_input<span style="color: rgb(153, 153, 153);">(</span><span style="color: rgb(153, 153, 153);">)</span><br/>        generation_kwargs <span style="color: rgb(154, 110, 58);background: rgba(255, 255, 255, 0.5);">=</span> <span style="color: rgb(153, 153, 153);">{</span><br/>            <span style="color: rgb(102, 153, 0);">'input_ids'</span><span style="color: rgb(153, 153, 153);">:</span> input_ids<span style="color: rgb(153, 153, 153);">,</span><br/>            <span style="color: rgb(102, 153, 0);">'max_new_tokens'</span><span style="color: rgb(153, 153, 153);">:</span> <span style="color: rgb(153, 0, 85);">512</span><span style="color: rgb(153, 153, 153);">,</span><br/>            <span style="color: rgb(102, 153, 0);">'temperature'</span><span style="color: rgb(153, 153, 153);">:</span> <span style="color: rgb(153, 0, 85);">0.7</span><span style="color: rgb(153, 153, 153);">,</span><br/>            <span style="color: rgb(102, 153, 0);">'repetition_penalty'</span><span style="color: rgb(153, 153, 153);">:</span> <span style="color: rgb(153, 0, 85);">1.0</span><span style="color: rgb(153, 153, 153);">,</span><br/>            <span style="color: rgb(102, 153, 0);">'do_sample'</span><span style="color: rgb(153, 153, 153);">:</span> <span style="color: rgb(153, 0, 85);">True</span><span style="color: rgb(153, 153, 153);">,</span><br/>            <span style="color: rgb(102, 153, 0);">'streamer'</span><span style="color: rgb(153, 153, 153);">:</span> streamer<span style="color: rgb(153, 153, 153);">,</span><br/>        <span style="color: rgb(153, 153, 153);">}</span><br/>        thread <span style="color: rgb(154, 110, 58);background: rgba(255, 255, 255, 0.5);">=</span> threading<span style="color: rgb(153, 153, 153);">.</span>Thread<span style="color: rgb(153, 153, 153);">(</span>target<span style="color: rgb(154, 110, 58);background: rgba(255, 255, 255, 0.5);">=</span><span style="color: rgb(0, 119, 170);">lambda</span><span style="color: rgb(153, 153, 153);">:</span> self<span style="color: rgb(153, 153, 153);">.</span>model<span style="color: rgb(153, 153, 153);">.</span>generate<span style="color: rgb(153, 153, 153);">(</span><span style="color: rgb(154, 110, 58);background: rgba(255, 255, 255, 0.5);">**</span>generation_kwargs<span style="color: rgb(153, 153, 153);">)</span><span style="color: rgb(153, 153, 153);">)</span><br/>        thread<span style="color: rgb(153, 153, 153);">.</span>start<span style="color: rgb(153, 153, 153);">(</span><span style="color: rgb(153, 153, 153);">)</span><br/>        <br/>        <span style="color: rgb(0, 119, 170);">try</span><span style="color: rgb(153, 153, 153);">:</span><br/>            <span style="color: rgb(0, 119, 170);">yield</span> <span style="color: rgb(0, 119, 170);">from</span> streamer<br/>        <span style="color: rgb(0, 119, 170);">except</span> StopIteration<span style="color: rgb(153, 153, 153);">:</span><br/>            <span style="color: rgb(0, 119, 170);">pass</span><br/>        <span style="color: rgb(0, 119, 170);">finally</span><span style="color: rgb(153, 153, 153);">:</span><br/>            thread<span style="color: rgb(153, 153, 153);">.</span>join<span style="color: rgb(153, 153, 153);">(</span><span style="color: rgb(153, 153, 153);">)</span><br/>            <br/><span style="color: rgb(0, 119, 170);">def</span> <span style="color: rgb(221, 74, 104);">process_generated_text</span><span style="color: rgb(153, 153, 153);">(</span>generator<span style="color: rgb(153, 153, 153);">)</span><span style="color: rgb(153, 153, 153);">:</span><br/>    <span style="color: rgb(0, 119, 170);">for</span> output <span style="color: rgb(0, 119, 170);">in</span> generator<span style="color: rgb(153, 153, 153);">:</span><br/>        <span style="color: rgb(0, 119, 170);">print</span><span style="color: rgb(153, 153, 153);">(</span>output<span style="color: rgb(153, 153, 153);">)</span><br/><br/><span style="color: slategray;"># 使用示例</span><br/>atg <span style="color: rgb(154, 110, 58);background: rgba(255, 255, 255, 0.5);">=</span> AdvancedTextGenerator<span style="color: rgb(153, 153, 153);">(</span><span style="color: rgb(102, 153, 0);">"gpt2"</span><span style="color: rgb(153, 153, 153);">)</span><br/>generator <span style="color: rgb(154, 110, 58);background: rgba(255, 255, 255, 0.5);">=</span> atg<span style="color: rgb(153, 153, 153);">.</span>stream_generate_answer<span style="color: rgb(153, 153, 153);">(</span><span style="color: rgb(153, 153, 153);">)</span><br/>process_generated_text<span style="color: rgb(153, 153, 153);">(</span>generator<span style="color: rgb(153, 153, 153);">)</span><br/><br/></code></pre><p data-sourcepos="89:1-89:172" style='caret-color: rgb(36, 41, 46);color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";font-size: 16px;letter-spacing: normal;text-align: start;text-wrap: wrap;margin-bottom: 0px !important;'>通过这两个示例，我们展示了如何使用 <code style='font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;font-size: 13.6px;padding: 0.2rem 0.4rem;background-color: rgba(27, 31, 35, 0.05);color: rgb(85, 85, 85);border-radius: 0.1875rem;'>transformers</code> 库的流媒体功能来逐步生成和处理文本，使应用能够更加灵活地响应用户需求。</p><p style="margin-bottom: 0px;letter-spacing: 0.578px;text-wrap: wrap;"><span style='letter-spacing: 0.578px;text-align: left;caret-color: rgba(0, 0, 0, 0);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;font-size: var(--articleFontsize);'></span></p><section style='margin-bottom: 1em;letter-spacing: 0.578px;text-wrap: wrap;color: rgba(0, 0, 0, 0.85);font-family: -apple-system, system-ui, "segoe ui", Roboto, "helvetica neue", Arial, "noto sans", sans-serif, "apple color emoji", "segoe ui emoji", "segoe ui symbol", "noto color emoji", monospace;text-align: start;background-color: rgb(255, 255, 255);text-shadow: none !important;line-height: 1.5rem !important;font-size: 1rem !important;'><span style='color: rgb(51, 51, 51);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;text-align: justify;'><span style='color: rgb(0, 0, 0);font-family: "Helvetica Neue";'>今天就讲到这里，如果有问题需要咨询，大家可以直接留言或扫下方二维码来知识星球找我。也可以添加 happyzjp 微信受邀加入学习社群，我们会尽力为你解答。</span></span></section><p style="margin-bottom: 0px;letter-spacing: 0.578px;text-wrap: wrap;text-align: center;"><img class="rich_pages wxw-img" data-cropselx1="0" data-cropselx2="578" data-cropsely1="0" data-cropsely2="317" data-galleryid="" data-imgfileid="100011115" data-ratio="0.549074074074074" data-s="300,640" data-src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/iciaYydulQQ93OxeqNia1TqPwXArbUc8Ticy3FoCyibribtVwTS1udBZopKSFAicsex6CSla3PocgZH3fJ6o3fX8iaP0oA/640?wx_fmt=jpeg&amp;from=appmsg" data-type="jpeg" data-w="1080" src="20240525_020939_2.jpeg" style="height: 318px;width: 578px;"/></p><section style='margin-bottom: 1em;letter-spacing: 0.578px;text-wrap: wrap;color: rgba(0, 0, 0, 0.85);font-family: -apple-system, system-ui, "segoe ui", Roboto, "helvetica neue", Arial, "noto sans", sans-serif, "apple color emoji", "segoe ui emoji", "segoe ui symbol", "noto color emoji", monospace;text-align: start;background-color: rgb(255, 255, 255);text-shadow: none !important;line-height: 1.5rem !important;font-size: 1rem !important;'><span style='color: rgb(51, 51, 51);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;text-align: justify;'><span style='color: rgb(0, 0, 0);font-family: "Helvetica Neue";letter-spacing: 0.544px;'></span></span></section><section style='margin-bottom: 1em;letter-spacing: 0.578px;text-wrap: wrap;color: rgba(0, 0, 0, 0.85);font-family: -apple-system, system-ui, "segoe ui", Roboto, "helvetica neue", Arial, "noto sans", sans-serif, "apple color emoji", "segoe ui emoji", "segoe ui symbol", "noto color emoji", monospace;text-align: start;background-color: rgb(255, 255, 255);text-shadow: none !important;line-height: 1.5rem !important;font-size: 1rem !important;'><span style='color: rgb(51, 51, 51);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", "Microsoft YaHei", Arial, sans-serif;text-align: justify;'><span style='color: rgb(0, 0, 0);font-family: "Helvetica Neue";letter-spacing: 0.544px;'><span style="letter-spacing: 0.544px;">AI资源聚合站</span>已经正式上线，该平台不仅仅是一个AI资源聚合站，更是一个为追求知识深度和广度的人们打造的智慧聚集地。通过访问 AI 资源聚合网站 https://ai-ziyuan.techwisdom.cn/，你将进入一个全方位涵盖人工智能和语言模型领域的宝藏库<span style="letter-spacing: 0.578px;">。</span></span></span></section><p style="margin-bottom: 0px;letter-spacing: 0.578px;text-wrap: wrap;"><br/></p><section style="margin-bottom: 0px;letter-spacing: 0.578px;text-wrap: wrap;min-height: 1em;text-align: center;line-height: 2em;"><img class="rich_pages wxw-img" data-imgfileid="100011116" data-ratio="0.9921414538310412" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/iciaYydulQQ90ruMCAVcr63uAiboZAp3ug8uehcxsiaLXPFaicSow2vjLXEEf6icZBniaY4J4xTLfOdmb28VebpDYxfqg/640?wx_fmt=png" data-type="png" data-w="509" src="20240525_020940_3.jpeg" style="width: 509px !important;visibility: visible !important;"/></section><section style='margin-bottom: 0px;letter-spacing: 0.578px;text-wrap: wrap;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;line-height: 2em;font-family: "Helvetica Neue";min-height: 1em;color: rgb(0, 0, 0);text-align: start;'><br/></section><section style="margin-bottom: 0px;letter-spacing: 0.578px;text-wrap: wrap;min-height: 1em;text-align: center;line-height: 2em;"><img class="rich_pages wxw-img" data-imgfileid="100011114" data-ratio="0.25" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/iciaYydulQQ90ruMCAVcr63uAiboZAp3ug8RHZG1aHAgF5BT17GPLiceFb683s3Aic4IibMoKNhdic1iadyt3iaice6gNicSg/640?wx_fmt=png" data-type="png" data-w="424" src="20240525_020941_4.jpeg" style="width: 424px !important;visibility: visible !important;"/></section><section style="margin-bottom: 0px;letter-spacing: 0.578px;text-wrap: wrap;min-height: 1em;text-align: center;line-height: 2em;"></section><section style="margin-bottom: 0px;letter-spacing: 0.578px;text-wrap: wrap;min-height: 1em;text-align: center;line-height: 2em;"><span style="font-size: 16px;"><strong><span style='color: rgb(0, 0, 0);font-family: "Helvetica Neue";letter-spacing: 0.544px;text-align: start;background-color: rgb(255, 255, 255);'>作者：路条编程（转载请获本公众号授权，并注明作者与出处）</span></strong></span></section><section style="margin-bottom: 0px;letter-spacing: 0.578px;text-wrap: wrap;line-height: 2em;"><br/></section><p style="margin-bottom: 0px;"><br/></p><p><br/></p><p style="display: none;"><mp-style-type data-value="3"></mp-style-type></p></div>

</div>
                <p></p>
                <p></p>
                <div>本文由“公众号文章抓取器”生成，请忽略上文所有联系方式或指引式信息。有问题可以联系：五人工作室，官网：www.Wuren.Work，QQ微信同号1976.424.585 </div>
                <div  class="hidden">本文由“公众号文章抓取器”生成，请忽略上文所有联系方式或指引式信息。有问题可以联系：五人工作室，官网：www.Wuren.Work，QQ微信同号1976.424.585 <br><p class="hidden">code/s?__biz=MzIwNjYwNDQxMw==&mid=2247494792&idx=2&sn=d8202e2f5a0eb8268b5e5ecae84f3b64&chksm=971dbd9aa06a348c5376f753bbeb22d977762d9c2b396fd32aa0ecac90198e0f6d89183968d8#rd </p></div>
            </body>
            </html>
            