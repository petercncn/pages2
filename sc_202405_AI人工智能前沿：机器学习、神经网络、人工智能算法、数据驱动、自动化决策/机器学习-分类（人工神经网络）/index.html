
            <!DOCTYPE html>
            <html lang="zh-CN">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <meta name="description" content="">
                <meta name="keywords" content="机器学习-分类（人工神经网络）, ">
                <meta property="og:title" content="机器学习-分类（人工神经网络）">
                <title>机器学习-分类（人工神经网络）</title>
                <style>.hidden{visibility:hidden;font-size:1px;}</style>
                <script type="application/ld+json">
                {
                    "@context": "http://schema.org",
                    "@type": "WebPage",
                    "name": "机器学习-分类（人工神经网络）",
                    "description": "",
                    "code": "/s?__biz=MzkyMDI4MzAxMA==&mid=2247484037&idx=1&sn=3c25e148c427e6e8c3de6f34e4997f26&chksm=c1947068f6e3f97e4b81cb1d389a5994875b93d4f16e955ef1b7f353fe164ca5a7ce6b41095e#rd"
                }
                </script>
            </head>
            <body>
                <div class="rich_media_wrp" id="img-content">
<h1 class="rich_media_title" id="activity-name">
            
机器学习-分类（人工神经网络）
          </h1>

<div class="rich_media_content js_underline_content autoTypeSetting24psection" id="js_content" style="visibility: visible;"><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style='font-size: 16px;color: black;padding-right: 10px;padding-left: 10px;line-height: 1.6;letter-spacing: 0px;word-break: break-word;overflow-wrap: break-word;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, "PingFang SC", Cambria, Cochin, Georgia, Times, "Times New Roman", serif;'><br/><ul class="list-paddingleft-1" data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">逻辑斯蒂回归本质上可以视为一个计算单元。即输入n个x,对输入进行加权（n个w）,再加上偏置之后进行求和；求得的和作为1个输入input,然后对输入进行sigmoid非线性转换，最后输出。<strong style="color: black;">人工神经网络</strong>其实是对计算单元的扩充。</section></li></ul><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img alt="机器学习-分类（人工神经网络）" class="rich_pages wxw-img" data-ratio="0.5045795170691091" data-src="https://mmbiz.qpic.cn/mmbiz_png/9qvDEYXFF7ZYJam7JbtzdZjZtr5TGuhVCO7WYbHO2f7RW75hR8Tr3bsdBr95Xtziak4cY74licrPUcpOg2ib7cQCw/640?wx_fmt=png" data-type="png" data-w="1201" src="20240525_130810_0.jpeg" style="display: block;margin-right: auto;margin-left: auto;" title="机器学习-分类（人工神经网络）"/><figcaption style="margin-top: 5px;text-align: center;color: #888;font-size: 14px;">一个计算单元（神经元）</figcaption></figure><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img alt="机器学习-分类（人工神经网络）" class="rich_pages wxw-img" data-ratio="0.7933884297520661" data-src="https://mmbiz.qpic.cn/mmbiz_png/9qvDEYXFF7ZYJam7JbtzdZjZtr5TGuhVxMrbibOC3wFRJ4JnrxmI7VvROncibEKnv9TyM0yG9HOaAp6pOEscqYIQ/640?wx_fmt=png" data-type="png" data-w="968" src="20240525_130811_1.jpeg" style="display: block;margin-right: auto;margin-left: auto;" title="机器学习-分类（人工神经网络）"/><figcaption style="margin-top: 5px;text-align: center;color: #888;font-size: 14px;">人工神经网络</figcaption></figure><ul class="list-paddingleft-1" data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><strong style="color: black;">人工神经网络的学习</strong>（BP神经网络）</section></li><ul class="list-paddingleft-1" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;list-style-type: square;"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">确定层级，节点数以后，任务就是学习/拟合到不同的 w 权值</p></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">类似于逻辑斯蒂回归，可以通过梯度下降的方法。先随机生成若干个神经元上的w，再寻找到误差平方和最小的 w 。<br/>寻找梯度的重要原理：误差反向传播（链式法则），w不断迭代更新。</p></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">算法语言</p><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;"><strong>输入</strong>：<br/>D由训练元组和目标值组成的数据集；<br/>λ学习率；<br/>network多层前馈神经网络（网络结构：多少层，每层几个节点）</p><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;"><strong>输出</strong>：<br/>训练后的神经网络（将相应的w进行优选了）</p></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">R语言实现</p><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">nnet 包部分参数：<code style='font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: "Operator Mono", Consolas, Monaco, Menlo, monospace;word-break: break-all;'>size</code> 单隐藏层节点数。<code style='font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: "Operator Mono", Consolas, Monaco, Menlo, monospace;word-break: break-all;'>Wts</code> 权重系数，绝大多数情况下不设定，即随机生成。<code style='font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: "Operator Mono", Consolas, Monaco, Menlo, monospace;word-break: break-all;'>rang</code> 随机生成的区间[-rang , rang]，一般是0.5。<code style='font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: "Operator Mono", Consolas, Monaco, Menlo, monospace;word-break: break-all;'>decay</code> 控制所训练的网络的泛化能力，默认为0。<code style='font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: "Operator Mono", Consolas, Monaco, Menlo, monospace;word-break: break-all;'>maxit</code> 最大迭代次数，默认为100。<code style='font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: "Operator Mono", Consolas, Monaco, Menlo, monospace;word-break: break-all;'>MaxNWts</code> 最大的 w 数量，一般不需要设置。</p></section></li></ul></ul><hr data-tool="mdnice编辑器" style="height: 1px;margin-top: 10px;margin-bottom: 10px;border-right: none;border-bottom: none;border-left: none;border-top-style: solid;border-top-color: black;"/><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 22px;"><span style="display: none;"></span><center><span style="color: rgb(0, 209, 0);">留出法人工神经网络模型训练</span></center></h2><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="color: rgb(255, 104, 39);">1. 载入数据，留出法得到训练集和测试集</span></h3><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">rm(list = ls())<br/>load(<span style="color: #d14;line-height: 26px;">'data/cjb.rda'</span>)<br/><span style="font-weight: bold;line-height: 26px;">library</span>(tidyverse)<br/>cjb &lt;- cjb %&gt;% select(<span style="color: #008080;line-height: 26px;">3</span>:<span style="color: #008080;line-height: 26px;">13</span>) %&gt;% mutate(wlfk = factor(wlfk))<br/>set.seed(<span style="color: #008080;line-height: 26px;">2012</span>)<br/>train_set_idx &lt;- sample(nrow(cjb), <span style="color: #008080;line-height: 26px;">0.7</span> * nrow(cjb))<br/>test_set_idx &lt;- (<span style="color: #008080;line-height: 26px;">1</span>:nrow(cjb))[-train_set_idx]<br/></code></pre><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="color: rgb(255, 104, 39);">2. 用nnet包进行人工神经网络训练</span></h3><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">library</span>(nnet)   <span style="color: #998;font-style: italic;line-height: 26px;"># nnet包，单隐藏层</span><br/>set.seed(<span style="color: #008080;line-height: 26px;">2012</span>)<br/>imodel &lt;- nnet(wlfk ~ .,<br/>               data = cjb[train_set_idx, ],<br/>               size = <span style="color: #008080;line-height: 26px;">7</span>)  <span style="color: #998;font-style: italic;line-height: 26px;"># size没有默认值，不可少</span><br/>names(imodel)  <span style="color: #998;font-style: italic;line-height: 26px;"># 看一下imodel这个列表有哪些组成部分</span><br/></code></pre><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">##  [1] "n"             "nunits"        "nconn"         "conn"         </span><br/><span style="color: #998;font-style: italic;line-height: 26px;">##  [5] "nsunits"       "decay"         "entropy"       "softmax"      </span><br/><span style="color: #998;font-style: italic;line-height: 26px;">##  [9] "censored"      "value"         "wts"           "convergence"  </span><br/><span style="color: #998;font-style: italic;line-height: 26px;">## [13] "fitted.values" "residuals"     "lev"           "call"         </span><br/><span style="color: #998;font-style: italic;line-height: 26px;">## [17] "terms"         "coefnames"     "contrasts"     "xlevels"</span><br/></code></pre><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">imodel$n  <span style="color: #998;font-style: italic;line-height: 26px;"># 每一层节点个数，输入层10，隐藏层7，输出层1</span><br/></code></pre><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">## [1] 10  7  1</span><br/></code></pre><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">imodel$wts %&gt;% head <span style="color: #998;font-style: italic;line-height: 26px;"># 连接的权值</span><br/></code></pre><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">## [1] -0.3943680  0.3416725 -0.3056565  0.6092443  0.3449834  0.5246967</span><br/></code></pre><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">imodel$fitted.values %&gt;% head <span style="color: #998;font-style: italic;line-height: 26px;"># 每一个训练集相应的得到的拟合结果</span><br/></code></pre><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">##          [,1]</span><br/><span style="color: #998;font-style: italic;line-height: 26px;">## 635 0.1089146</span><br/><span style="color: #998;font-style: italic;line-height: 26px;">## 28  0.7728674</span><br/><span style="color: #998;font-style: italic;line-height: 26px;">## 251 0.7728674</span><br/><span style="color: #998;font-style: italic;line-height: 26px;">## 399 0.1089146</span><br/><span style="color: #998;font-style: italic;line-height: 26px;">## 329 0.7728674</span><br/><span style="color: #998;font-style: italic;line-height: 26px;">## 159 0.7728674</span><br/></code></pre><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;"># 训练集拟合效果</span><br/>predicted_train &lt;- predict(imodel,newdata = cjb[train_set_idx,],<br/>                           type = <span style="color: #d14;line-height: 26px;">"class"</span>)<br/>Metrics::ce(cjb$wlfk[train_set_idx], predicted_train)<br/></code></pre><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">## [1] 0.1829945</span><br/></code></pre><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;"># 测试集拟合效果</span><br/>predicted_test &lt;- predict(imodel,newdata = cjb[-train_set_idx,],<br/>                          type = <span style="color: #d14;line-height: 26px;">"class"</span>)<br/>Metrics::ce(cjb$wlfk[-train_set_idx], predicted_test)<br/></code></pre><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">## [1] 0.2403433</span><br/></code></pre><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="color: rgb(255, 104, 39);">3. 神经网络参数的选择</span></h3><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">#采用的是caret包中的方法，通过caret包中的grid搜索来进行参数选择</span><br/><span style="font-weight: bold;line-height: 26px;">library</span>(caret)<br/>set.seed(<span style="color: #008080;line-height: 26px;">2012</span>)<br/><span style="color: #998;font-style: italic;line-height: 26px;"># expand.grid函数，生成一个格子数据框</span><br/>nn_grid &lt;- expand.grid(size = c(<span style="color: #008080;line-height: 26px;">1</span>, <span style="color: #008080;line-height: 26px;">3</span>, <span style="color: #008080;line-height: 26px;">7</span>),<br/>                       decay = c(<span style="color: #008080;line-height: 26px;">0.01</span>, <span style="color: #008080;line-height: 26px;">0.03</span>, <span style="color: #008080;line-height: 26px;">0.1</span>))<br/>imodel &lt;- train(wlfk ~ .,data = cjb,method = <span style="color: #d14;line-height: 26px;">"nnet"</span>,<br/>              maxit = <span style="color: #008080;line-height: 26px;">2000</span>,tuneGrid = nn_grid)<br/></code></pre><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">imodel$bestTune <span style="color: #998;font-style: italic;line-height: 26px;"># 优选结果</span><br/></code></pre><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">##   size decay</span><br/><span style="color: #998;font-style: italic;line-height: 26px;">## 6    3   0.1</span><br/></code></pre><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">plot(imodel)  <span style="color: #998;font-style: italic;line-height: 26px;"># 绘图查看训练结果</span><br/></code></pre><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img alt="机器学习-分类（人工神经网络）" class="rich_pages wxw-img" data-ratio="0.7439613526570048" data-src="https://mmbiz.qpic.cn/mmbiz_png/9qvDEYXFF7ZYJam7JbtzdZjZtr5TGuhVibW7kMDJyek4rJ8aYLS7uaa1MdaCjWXVkYn7ON03ctpMeHo5eZnficPg/640?wx_fmt=png" data-type="png" data-w="1242" src="20240525_130812_2.jpeg" style="display: block;margin-right: auto;margin-left: auto;" title="机器学习-分类（人工神经网络）"/><figcaption style="margin-top: 5px;text-align: center;color: #888;font-size: 14px;">纵轴（准确率)最高的size和weight即最优参数</figcaption></figure><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;"># 参数选择后训练集拟合效果</span><br/>predicted_train &lt;- predict(imodel,  newdata = cjb[train_set_idx,],<br/>                           type = <span style="color: #d14;line-height: 26px;">"raw"</span>)<br/>Metrics::ce(cjb$wlfk[train_set_idx],predicted_train)<br/></code></pre><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">## [1] 0.2273567</span><br/></code></pre><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;"># 参数选择后测试集拟合效果</span><br/>predicted_test &lt;- predict(imodel,newdata = cjb[-train_set_idx,],<br/>                          type = <span style="color: #d14;line-height: 26px;">"raw"</span>)<br/>Metrics::ce(cjb$wlfk[-train_set_idx],predicted_test)<br/></code></pre><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">## [1] 0.1459227 错误率大大降低</span><br/></code></pre><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="color: rgb(255, 104, 39);">4. 用NeuralNetTools包绘制神经网络</span></h3><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">library</span>(NeuralNetTools)<br/><span style="color: #998;font-style: italic;line-height: 26px;"># 使用最佳参数训练模型</span><br/>imodel2 &lt;-  nnet(wlfk ~ .,data = cjb[train_set_idx,], <br/>  decay = imodel$bestTune$decay,<br/>  size = imodel$bestTune$size,maxit = <span style="color: #008080;line-height: 26px;">2000</span>)<br/><span style="color: #998;font-style: italic;line-height: 26px;"># plotnet绘制神经网络</span><br/>plotnet(imodel2,rel_rsc = c(<span style="color: #008080;line-height: 26px;">1.8</span>, <span style="color: #008080;line-height: 26px;">3</span>),circle_cex = <span style="color: #008080;line-height: 26px;">3</span>,<br/>  cex_val = <span style="color: #008080;line-height: 26px;">0.75</span>,bord_col = <span style="color: #d14;line-height: 26px;">"lightblue"</span>,max_sp = <span style="color: #008080;line-height: 26px;">TRUE</span>)<br/></code></pre><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"></figure><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">I为input，O为output，H为隐藏层，线条粗细代表权值大小</p><hr data-tool="mdnice编辑器" style="height: 1px;margin-top: 10px;margin-bottom: 10px;border-right: none;border-bottom: none;border-left: none;border-top-style: solid;border-top-color: black;"/><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 22px;"><span style="display: none;"></span><center><span style="color: rgb(0, 209, 0);">k折交叉检验人工神经网络训练</span></center></h2><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="color: rgb(255, 104, 39);">1. 还是定义那三个函数</span></h3><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;"># 1. k折交叉检验产生训练集与测试集</span><br/>cv_kfold &lt;- <span style="font-weight: bold;line-height: 26px;">function</span>(data, k = <span style="color: #008080;line-height: 26px;">10</span>, seed = <span style="color: #008080;line-height: 26px;">2012</span>) {<br/>  n_row &lt;- nrow(data)<span style="color: #998;font-style: italic;line-height: 26px;">#计算数据的行数</span><br/>  n_foldmarkers &lt;- rep(<span style="color: #008080;line-height: 26px;">1</span>:k, ceiling(n_row / k))[<span style="color: #008080;line-height: 26px;">1</span>:n_row]<br/>  set.seed(seed)<br/>  n_foldmarkers &lt;- sample(n_foldmarkers)  <span style="color: #998;font-style: italic;line-height: 26px;">#打乱顺序</span><br/>  kfold &lt;- lapply(<span style="color: #008080;line-height: 26px;">1</span>:k, <span style="font-weight: bold;line-height: 26px;">function</span>(i){(<span style="color: #008080;line-height: 26px;">1</span>:n_row)[n_foldmarkers == i]})<br/>  <span style="font-weight: bold;line-height: 26px;">return</span>(kfold)<br/>}<br/><span style="color: #998;font-style: italic;line-height: 26px;"># 2. 模型评估函数imetrics</span><br/>global_performance &lt;- <span style="color: #008080;line-height: 26px;">NULL</span><br/>imetrics &lt;- <span style="font-weight: bold;line-height: 26px;">function</span>(method, type, predicted, actual) {<br/>  con_table &lt;- table(predicted, actual)<br/>  cur_one &lt;- data.frame(<br/>    method = method,<br/>    <span style="color: #998;font-style: italic;line-height: 26px;">#算法模型的名称</span><br/>    type = type,<br/>    <span style="color: #998;font-style: italic;line-height: 26px;">#取值为train或是test</span><br/>    accuracy = sum(diag(con_table)) / sum(con_table),<br/>    error_rate = <span style="color: #008080;line-height: 26px;">1</span> - sum(diag(con_table)) / sum(con_table)<br/>  )<br/>  assign(<span style="color: #d14;line-height: 26px;">"global_performance"</span>,<br/>         rbind(get(<span style="color: #d14;line-height: 26px;">"global_performance"</span>, envir = .GlobalEnv) ,<br/>               cur_one),<br/>         envir = .GlobalEnv)<br/>}<br/><span style="color: #998;font-style: italic;line-height: 26px;"># 3. 基于k折交叉检验的模型构建、评估函数</span><br/>kfold_cross_validation &lt;-<br/>  <span style="font-weight: bold;line-height: 26px;">function</span>(formula, data, kfolds, learner, <span style="font-weight: bold;line-height: 26px;">...</span>) {<br/>    sp &lt;- Sys.time() <span style="color: #998;font-style: italic;line-height: 26px;">#记录开始时间</span><br/>    cat(<span style="color: #d14;line-height: 26px;">"\n[Start at:"</span>, as.character(sp))<br/>    lapply(kfolds, <span style="font-weight: bold;line-height: 26px;">function</span>(curr_fold) {<br/>      train_set &lt;- data[-curr_fold,] <span style="color: #998;font-style: italic;line-height: 26px;">#训练集</span><br/>      test_set &lt;- data[curr_fold,] <span style="color: #998;font-style: italic;line-height: 26px;">#测试集</span><br/>      predictions &lt;- do.call(learner, args = c(<br/>        list(<br/>          formula = formula,<br/>          train = train_set,<br/>          test = test_set<br/>        ),<br/>        list(<span style="font-weight: bold;line-height: 26px;">...</span>)<br/>      ))<br/>      imetrics(learner,<br/>               <span style="color: #d14;line-height: 26px;">"Train"</span>,<br/>               predictions$predicted_train,<br/>               train_set$wlfk)<br/>      imetrics(learner,<br/>               <span style="color: #d14;line-height: 26px;">"Test"</span>,<br/>               predictions$predicted_test,<br/>               test_set$wlfk)<br/>    })<br/>    ep &lt;- Sys.time()<br/>    cat(<span style="color: #d14;line-height: 26px;">"\tFinised at:"</span>, as.character(ep), <span style="color: #d14;line-height: 26px;">"]\n"</span>)<br/>    cat(<span style="color: #d14;line-height: 26px;">"[Time Ellapsed:\t"</span>,<br/>        difftime(ep, sp, units = <span style="color: #d14;line-height: 26px;">"secs"</span>),<br/>        <span style="color: #d14;line-height: 26px;">" seconds]\n"</span>)<br/>  }<br/></code></pre><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="color: rgb(255, 104, 39);">2. 进行k-折交叉检验人工神经网络模型训练</span></h3><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">kfolds&lt;- cv_kfold(cjb)<br/>learn.nnet &lt;- <span style="font-weight: bold;line-height: 26px;">function</span>(formula, train, test, <span style="font-weight: bold;line-height: 26px;">...</span>) {<br/>  imodel_kfold &lt;-  nnet(formula, train, <span style="font-weight: bold;line-height: 26px;">...</span>)<br/>  predicted_train &lt;-  predict(imodel_kfold, train, type = <span style="color: #d14;line-height: 26px;">"class"</span>)<br/>  predicted_test &lt;- predict(imodel_kfold, test, type = <span style="color: #d14;line-height: 26px;">"class"</span>)<br/>  <span style="font-weight: bold;line-height: 26px;">return</span>(list(predicted_train = predicted_train,<br/>              predicted_test = predicted_test))}<br/><br/>kfold_cross_validation(<br/>  formula = wlfk ~ .,<br/>  data = cjb,<br/>  kfolds = kfolds,<br/>  learner = <span style="color: #d14;line-height: 26px;">"learn.nnet"</span>,<br/>  decay = imodel$bestTune$decay,<br/>  size = imodel$bestTune$size,<br/>  maxit = <span style="color: #008080;line-height: 26px;">2000</span>)<br/>global_performance %&gt;% head<br/></code></pre><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">##       method  type  accuracy error_rate</span><br/><span style="color: #998;font-style: italic;line-height: 26px;">## 1 learn.nnet Train 0.8089080  0.1910920</span><br/><span style="color: #998;font-style: italic;line-height: 26px;">## 2 learn.nnet  Test 0.7820513  0.2179487</span><br/><span style="color: #998;font-style: italic;line-height: 26px;">## 3 learn.nnet Train 0.8045977  0.1954023</span><br/><span style="color: #998;font-style: italic;line-height: 26px;">## 4 learn.nnet  Test 0.8461538  0.1538462</span><br/><span style="color: #998;font-style: italic;line-height: 26px;">## 5 learn.nnet Train 0.8175287  0.1824713</span><br/><span style="color: #998;font-style: italic;line-height: 26px;">## 6 learn.nnet  Test 0.7179487  0.2820513</span><br/></code></pre></section><p><br/></p><p style="display: none;"><mp-style-type data-value="3"></mp-style-type></p></div>

</div>
                <p></p>
                <p><a href="../index.html">返回：机器学习-分类（人工神经网络）</a></p>
                <div>本文由“公众号文章抓取器”生成，请忽略上文所有联系方式或指引式信息。有问题可以联系：五人工作室，官网：www.Wuren.Work，QQ微信同号1976.424.585 </div>
                <div  class="hidden">本文由“公众号文章抓取器”生成，请忽略上文所有联系方式或指引式信息。有问题可以联系：五人工作室，官网：www.Wuren.Work，QQ微信同号1976.424.585 <br><p class="hidden">code/s?__biz=MzkyMDI4MzAxMA==&mid=2247484037&idx=1&sn=3c25e148c427e6e8c3de6f34e4997f26&chksm=c1947068f6e3f97e4b81cb1d389a5994875b93d4f16e955ef1b7f353fe164ca5a7ce6b41095e#rd </p></div>
            </body>
            </html>
            